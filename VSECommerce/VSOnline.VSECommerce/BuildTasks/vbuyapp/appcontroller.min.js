/*! VBuyApp 29-04-2016 */
app.controller("StoresController",["$scope","$http","$routeParams","$rootScope","localStorageService","storesService","productService","breadcrumbs",function(a,b,c,d,e,f,g,h){function i(){var d=c.storeId?parseInt(c.storeId):0,e=c.branchId?parseInt(c.branchId):0,g=c.productId?parseInt(c.productId):0;a.EnableBuy=!1,f.getStoreInfo(b,d).then(function(b){a.StoreInfo=b.data,e>0?(a.selectedBranchId=e,a.EnableBuy=b.data.Branches[0].EnableBuy,j()):(a.selectedBranchId=b.data.Branches[0].BranchId,a.EnableBuy=b.data.Branches[0].EnableBuy,j())},function(b){a.message=b.error_description}),a.RefreshBranchAddress=function(){j()},f.getFilter(b,d,g).then(function(b){a.filterList=b.data,b.data.SelectedFilters.SelectedCategory?(a.filters.selectedCategory=b.data.SelectedFilters.SelectedCategory,a.filters.selectedSubCategory=b.data.SelectedFilters.SelectedSubCategory):(a.filters.selectedSubCategory=b.data.SubCategoryFilter[0].CategoryId,a.filters.selectedCategory=b.data.SubCategoryFilter[0].ParentCategoryId),a.GetProducts()},function(b){a.message=b.error_description})}function j(){f.getRatings(a,b,a.selectedBranchId).then(function(b){var c=l(b.data);a.branchRating=c.toFixed(1)})}function k(){d.comparisonlistProductId.splice(0,d.comparisonlistProductId.length);for(var a=0;a<d.comparisonlist.length;a++)d.comparisonlistProductId.push(d.comparisonlist[a].ProductId)}a.message="",a.filterList={},a.products={},a.StoreInfo={},a.filters={},a.branchAddress={},a.branchRating=0,a.contactData={},a.contactData.message="",a.EnableBuy=!1,h.options={Stores:c.friendlyUrl},a.GetProducts=function(){f.getStoreProducts(a,b).then(function(b){a.products=b.data},function(b){a.message=b.error_description})},a.onSellerRatingChanged=function(c){a.userName&&a.userName.length>0?f.updateRatings(a,b,a.userName,a.selectedBranchId,c).then(function(b){var c=l(b.data);a.branchRating=c.toFixed(1)}):(j(),$("#modal-container-Register").modal({show:!0}))};var l=function(a){for(var b=0,c=0,d=0;d<a.length;d++)b+=a[d].Rating*a[d].RatingCount,c+=a[d].RatingCount;return b/c};i(),a.ContactSeller=function(c,d,e){return c.message="",c.Mobile&&10==c.Mobile.toString().length?c&&d&&e&&g.contactSeller(a,b,c.Name,c.Email,c.Mobile,c.Subject,d,e).then(function(a){"failed"===a.data?(c.savedSuccessfully=!1,c.message=" You can only sent one message to the store for same product in 2 hours."):"OK"==a.statusText?(c.savedSuccessfully=!0,c.message="Message Sent",$timeout(function(){c.message=""},4e3)):(c.savedSuccessfully=!1,c.message="Sorry. Please resend the details.")}):(c.savedSuccessfully=!1,c.message=" Mobile number should be 10 digits"),!1},a.addToProductComparison=function(b){var c=$("#img_"+b.ProductId);if(d.comparisonlist.length>=4)return void(a.message="Only 4 products can be compared.");flyToElement($(c),$("#compareTopLink"));var f=m(b);d.comparisonlist.length<4&&(d.comparisonlist.push(f),e.set("comparisonlist",d.comparisonlist),k())};var m=function(a){var b={};return b.ProductId=a.ProductId,b.Name=a.Name,b.PictureName=a.PictureName,b.SpecialPrice=a.SpecialPrice,b.Price=a.Price,b.StoresCount=a.StoresCount,b.FlagWishlist=a.FlagWishlist,b}}]),app.controller("CartController",["$scope","$location","$http","$rootScope","$routeParams","localStorageService","$timeout","cartService",function(a,b,c,d,e,f,g,h){function i(){j()}function j(){d.cartTotal=0,a.totalShipping=0;for(var b=0;b<d.cartlist.length;b++)d.cartTotal=d.cartTotal+d.cartlist[b].SubTotal,a.totalShipping=a.totalShipping+d.cartlist[b].TotalAdditionalShippingCharge;f.set("cartlist",d.cartlist)}a.message="",a.totalShipping=0,i(),a.incrementProductQuantity=function(a){for(var b=0;b<d.cartlist.length;b++)d.cartlist[b].ProductId==a.ProductId&&(d.cartlist[b].Quantity=1*d.cartlist[b].Quantity+1,d.cartlist[b].TotalAdditionalShippingCharge=d.cartlist[b].AdditionalShippingCharge*d.cartlist[b].Quantity,d.cartlist[b].SubTotal=d.cartlist[b].SpecialPrice*d.cartlist[b].Quantity,d.cartlist[b].SubTotalWithShipping=d.cartlist[b].SpecialPrice*d.cartlist[b].Quantity+d.cartlist[b].TotalAdditionalShippingCharge,h.updateCartItemQuantity(c,d.cartlist[b],d.userName));j()},a.decrementProductQuantity=function(a){for(var b=0;b<d.cartlist.length;b++)d.cartlist[b].ProductId==a.ProductId&&d.cartlist[b].Quantity>1&&(d.cartlist[b].Quantity=1*d.cartlist[b].Quantity-1,d.cartlist[b].TotalAdditionalShippingCharge=d.cartlist[b].AdditionalShippingCharge*d.cartlist[b].Quantity,d.cartlist[b].SubTotal=d.cartlist[b].SpecialPrice*d.cartlist[b].Quantity,d.cartlist[b].SubTotalWithShipping=d.cartlist[b].SpecialPrice*d.cartlist[b].Quantity+d.cartlist[b].TotalAdditionalShippingCharge,h.updateCartItemQuantity(c,d.cartlist[b],d.userName)),j()},a.qtyChanged=function(a){(a.Quantity<1||a.Quantity>100||!a.Quantity)&&(a.Quantity=1),setTimeout(function(){for(var b=0;b<d.cartlist.length;b++)d.cartlist[b].ProductId==a.ProductId&&(d.cartlist[b].Quantity=parseInt(a.Quantity),d.cartlist[b].TotalAdditionalShippingCharge=d.cartlist[b].AdditionalShippingCharge*d.cartlist[b].Quantity,d.cartlist[b].SubTotal=d.cartlist[b].SpecialPrice*d.cartlist[b].Quantity,d.cartlist[b].SubTotalWithShipping=d.cartlist[b].SpecialPrice*d.cartlist[b].Quantity+d.cartlist[b].TotalAdditionalShippingCharge,h.updateCartItemQuantity(c,d.cartlist[b],d.userName));j()},0)},a.removeProductFromCart=function(a){for(var b=-1,e=0;e<d.cartlist.length;e++)d.cartlist[e].ProductId==a.ProductId&&(b=e);if(b>-1){var g=d.cartlist.splice(b,1);g.length>0&&d.flagLoggedIn&&h.removeShoppingCartItem(c,g[0],d.userName),f.set("cartlist",d.cartlist)}j(),event.stopPropagation()}}]),app.controller("CheckoutController",["$scope","$location","$http","$rootScope","$routeParams","$cookieStore","localStorageService","$window","userActionService","cartService",function(a,b,c,d,e,f,g,h,i,j){function k(){m(),l()}function l(){j.getBuyerAddress(c,a.userName).then(function(b){a.buyerAddress=b.data})}function m(){d.cartTotal=0,a.totalShipping=0;for(var b=0;b<d.cartlist.length;b++)d.cartTotal=d.cartTotal+d.cartlist[b].SubTotal,a.totalShipping=a.totalShipping+d.cartlist[b].TotalAdditionalShippingCharge;d.cartTotal>0&&a.orderDiscount>0&&d.cartTotal-a.orderDiscount>0&&(a.netPayable=d.cartTotal-a.orderDiscount+a.totalShipping),g.set("cartlist",d.cartlist)}a.message="",a.passwordCheckbox=!1,a.checkoutAddress=!1,a.buyerAddress={},a.couponCode="",a.orderDiscount=0,a.netPayable=0,a.totalShipping=0;var n=function(){"https"!==b.protocol()};n(),k(),d.$watch("flagLoggedIn",function(){l()}),a.onAddressTabClick=function(){l()},a.applyCoupon=function(){j.getCartDiscount(c,d.cartlist,d.userName,a.couponCode).then(function(b){a.orderDiscount=b.data})},a.postCartitemChangesInCheckout=function(){a.applyCoupon(),m()},a.incrementProductQuantity=function(b){for(var e=0;e<d.cartlist.length;e++)d.cartlist[e].ProductId==b.ProductId&&(d.cartlist[e].Quantity=1*d.cartlist[e].Quantity+1,d.cartlist[e].TotalAdditionalShippingCharge=d.cartlist[e].AdditionalShippingCharge*d.cartlist[e].Quantity,d.cartlist[e].SubTotal=d.cartlist[e].SpecialPrice*d.cartlist[e].Quantity,d.cartlist[e].SubTotalWithShipping=d.cartlist[e].SpecialPrice*d.cartlist[e].Quantity+d.cartlist[e].TotalAdditionalShippingCharge,d.flagLoggedIn&&j.updateCartItemQuantity(c,d.cartlist[e],d.userName).then(function(){a.postCartitemChangesInCheckout()}));m()},a.decrementProductQuantity=function(b){for(var e=0;e<d.cartlist.length;e++)d.cartlist[e].ProductId==b.ProductId&&d.cartlist[e].Quantity>1&&(d.cartlist[e].Quantity=1*d.cartlist[e].Quantity-1,d.cartlist[e].TotalAdditionalShippingCharge=d.cartlist[e].AdditionalShippingCharge*d.cartlist[e].Quantity,d.cartlist[e].SubTotal=d.cartlist[e].SpecialPrice*d.cartlist[e].Quantity,d.cartlist[e].SubTotalWithShipping=d.cartlist[e].SpecialPrice*d.cartlist[e].Quantity+d.cartlist[e].TotalAdditionalShippingCharge,d.flagLoggedIn&&j.updateCartItemQuantity(c,d.cartlist[e],d.userName).then(function(){a.postCartitemChangesInCheckout()})),m()},a.qtyChanged=function(b){setTimeout(function(){for(var e=0;e<d.cartlist.length;e++)d.cartlist[e].ProductId==b.ProductId&&(d.cartlist[e].Quantity=parseInt(b.Quantity),d.cartlist[e].TotalAdditionalShippingCharge=d.cartlist[e].AdditionalShippingCharge*d.cartlist[e].Quantity,d.cartlist[e].SubTotal=d.cartlist[e].SpecialPrice*d.cartlist[e].Quantity,d.cartlist[e].SubTotalWithShipping=d.cartlist[e].SpecialPrice*d.cartlist[e].Quantity+d.cartlist[e].TotalAdditionalShippingCharge,d.flagLoggedIn&&j.updateCartItemQuantity(c,d.cartlist[e],d.userName).then(function(){a.postCartitemChangesInCheckout()}));m()},0)},a.addBuyerAddress=function(){j.addBuyerAddress(c,a.buyerAddress,a.userName).then(function(b){a.buyerAddress=b.data,a.tab="paymentTab"})},a.removeProductFromCart=function(b){for(var e=-1,f=0;f<d.cartlist.length;f++)d.cartlist[f].ProductId==b.ProductId&&(e=f);if(e>-1){var g=d.cartlist.splice(e,1);g.length>0&&d.flagLoggedIn&&j.removeShoppingCartItem(c,g[0],d.userName).then(function(){a.postCartitemChangesInCheckout()})}m(),event.stopPropagation()},a.confirmOrder=function(){j.generateOrder(c,d.cartlist,a.userName,a.paymentOption,a.deliveryOption,a.couponCode).then(function(a){d.cartlist={},d.cartTotal=0,(a.data>0||a.data.length>25)&&g.remove("cartlist"),a.data.length>25?(document.write(a.data),$("#payuForm").submit()):b.path("/confirmOrder/"+a.data)})}}]),app.controller("OrderConfirmationController",["$scope","$location","$http","$rootScope","$routeParams","cartService",function(a,b,c,d,e,f){function g(){f.getOrderConfirmationDetails(c,e.orderId,d.userName).then(function(b){if(b.data){a.orderConfirmation=b.data;var c=new Date(a.orderConfirmation.OrderDetails.OrderDateUtc+"Z");a.orderConfirmationDate=c}})}a.message="",a.orderConfirmation={},a.orderConfirmationDate="",g()}]),app.controller("OrderConfirmationFailureController",["$scope","$location","$http","$rootScope","$routeParams","cartService",function(a,b,c,d,e,f){function g(){f.getOrderConfirmationDetails(c,e.orderId,d.userName).then(function(b){b.data&&(a.orderConfirmation=b.data)})}a.message="",a.orderConfirmation={},g(),a.onReinitiatePayment=function(){f.initiatePaymentForOrder(c,d.userName,scope.orderConfirmation.OrderDetails.Id).then(function(a){a.data.length>25&&(document.write(a.data),$("#payuForm").submit())})}}]),app.controller("OrderConfirmationPayController",["$scope","$location","$http","$rootScope","$routeParams","cartService",function(){var a=document.forms.length;if(a>1){var b=document.forms[0].id;document.getElementById(b).serialize()}}]),app.controller("NavbarController",["$scope","$location","$http",function(a,b){a.getClass=function(a){return b.path().substr(0,a.length)==a?!0:!1}}]),app.controller("HomeSliderController",["$scope","$http","productService",function(a,b,c){a.messageOffers="";var d=document.getElementById("curLocation"),e=d.title,f=d.value;(null==e||""==e||"undefined"===e)&&(e=13.05831,f=80.21195),c.getTopOffers(a,b,e,f).then(function(b){a.offerProducts=b,a.messageOffers="",0==a.offerProducts.data.length&&(a.messageOffers="No Offers in selected Area.")})}]),app.controller("LandingController",["$rootScope","$scope","$http","$location","$anchorScroll","$q","filterFilter","landingService","productService","userActionService","authService","localStorageService","cartService","$filter","$cookieStore","breadcrumbs",function(a,b,c,d,e,f,g,h,j,k,l,m,n,o,p,q){function r(){h.getMainMenu(b,c).then(function(a){b.mainMenu=a}),h.getFeaturedProducts(b,c).then(function(a){b.featuredProducts=a}),h.getTopSellingProductList1(b,c).then(function(a){b.topSellingProductList1=a}),h.loadLocationList(b,c).then(function(a){b.locationlist=a}),h.loadCurrentLocation(b,c),h.topSellingProductList2(b,c).then(function(a){b.personalizedProductList1=a}),h.getTopCategoriesList(b,c).then(function(a){b.topCategoryList=a}),h.getHomeBannerSettings(b,c).then(function(a){b.homeBannerSettings=a.data}),a.userName&&a.userName.length>0&&k.getUserWishlistCount(b,c,a.userName).then(function(b){a.wishlistCount=b.data}),b.addProductWishlist=function(d){if(a.userName&&a.userName.length>0){var e=$("#img_"+d.ProductId);flyToElement($(e),$("#wishlistTopLink")),k.addUserWishlist(b,c,b.userName,d.ProductId).then(function(c){b.wishlist=c.data,d.FlagWishlist=!0,a.wishlistCount=c.data.length})}else $("#modal-container-Register").modal({show:!0,backdrop:!0})},t(),u()}function s(){return void 0!==window.ontouchstart}function t(){a.comparisonlistProductId.splice(0,a.comparisonlistProductId.length);for(var b=0;b<a.comparisonlist.length;b++)a.comparisonlistProductId.push(a.comparisonlist[b].ProductId)}function u(){a.cartTotal=0,b.totalShipping=0;for(var c=0;c<a.cartlist.length;c++)a.cartTotal=a.cartTotal+a.cartlist[c].SubTotal,b.totalShipping=b.totalShipping+a.cartlist[c].TotalAdditionalShippingCharge;m.set("cartlist",a.cartlist)}function v(b){for(var d=0;d<a.cartlist.length;d++)if(a.cartlist[d].ProductId==b.ProductId)return a.cartlist[d].Quantity=a.cartlist[d].Quantity+1,a.cartlist[d].TotalAdditionalShippingCharge=a.cartlist[d].AdditionalShippingCharge*a.cartlist[d].Quantity,a.cartlist[d].SubTotal=a.cartlist[d].SpecialPrice*a.cartlist[d].Quantity,a.cartlist[d].SubTotalWithShipping=a.cartlist[d].SpecialPrice*a.cartlist[d].Quantity+a.cartlist[d].TotalAdditionalShippingCharge,n.updateCartItemQuantity(c,a.cartlist[d],a.userName),a.cartMessage="Success",w(),productExist=!0;return!1}function w(){$("#cart-success-alert").fadeTo(2e3,500).slideUp(500,function(){a.cartMessage=""})}function x(){$("#cart-failure-alert").fadeTo(2e3,500).slideUp(500,function(){a.cartFailureMessage=""})}b.error="",b.showAreaList=!1,b.breadcrumbs=q,b.homeBannerSettings={},b.LogOut=function(){l.logOut(),a.flagLoggedIn=!1,m.remove("userName"),m.remove("flagLoggedIn"),a.userName="",a.wishlistCount=0,d.path("/Home")},b.searchCatalogue=function(){b.error="";var a=document.getElementById("curLocation");if(void 0!=b.selectedArea&&void 0!=b.selectedArea.Latitude)a.title=b.selectedArea.Latitude,a.value=b.selectedArea.Longitude;else if(!a.title||b.selectedArea)return void(b.error="Area not exist. Please select your Area");var c=b.selectedProduct;(null!=b.selectedProduct.Name||void 0!=b.selectedProduct.Name)&&(c=b.selectedProduct.Name);var e=b.$parent.currentAddress;b.selectedArea&&b.selectedArea.AreaName&&(e=b.selectedArea.AreaName);var f={productFilter:c,areaName:e,lat:a.title,lng:a.value},g="/search";d.$$url=null,d.path(g).search(f)},b.getCurrentLocation=function(){h.loadCurrentLocation(b,c)},b.$on("$typeahead.select",function(a,c){b.error="";var e=document.getElementById("curLocation");if(c.Latitude&&c.Longitude&&(e.title=c.Latitude,e.value=c.Longitude,b.selectedArea=b.selectedAreaInput,showAreaList=!1),null!=c.Name&&null!=c.ProductId){var e=document.getElementById("curLocation"),f="/product/"+o("formaturl")(c.Name)+"/"+c.ProductId;d.path(f).search({lat:e.title,lng:e.value})}else if(b.selectedProduct&&(null!=b.selectedProduct.Name||void 0!=b.selectedProduct.Name)&&null!=c.AreaName){var f="/product/"+o("formaturl")(b.selectedProduct.Name)+"/"+b.selectedProduct.ProductId;d.path(f).search({lat:e.title,lng:e.value})}}),b.getLocationList=function(a){var d={address:a,sensor:!1,components:"country:India"};if(c.get("http://maps.googleapis.com/maps/api/geocode/json",{params:d}).then(function(a){if(null!=b.locationlist&&void 0!=b.locationlist){{b.locationlist.data}for(i=0;i<a.data.results.length;i++){var c={City:a.data.results[i].formatted_address,AreaName:a.data.results[i].formatted_address,Latitude:a.data.results[i].geometry.location.lat,Longitude:a.data.results[i].geometry.location.lng};b.locationlist.data.push(c)}}}),null!=b.locationlist&&void 0!=b.locationlist){var e=g(b.locationlist.data,a);return e}return null},b.searchProductList=[],b.searchRequests=[],b.getSearchProductList=function(a){if(a&&_.isString(a)){var d=h.getSearchProductList(b,c,f,a);return b.searchRequests.push(d),d.promise.then(function(a){return b.searchProductList=[],b.searchProductList.push(a),y(d),b.searchProductList[0]},function(){})}},b.cancel=function(a){a.cancel("User cancelled"),y(a)};var y=function(a){b.searchRequests.splice(b.searchRequests.indexOf(a),1)};b.closeMainMenu=function(){$("div.popup").css("visibility","hidden")},b.clickMainMenu=function(){s()?$("div.popup").css("visibility","visible"):$("div.popup").css("visibility","visible")};var z=null;b.showMainMenu=function(){z||(z=window.setTimeout(function(){z=null,$("div.popup").css("visibility","visible")},400))},b.menuMouseLeave=function(){z&&(window.clearTimeout(z),z=null,$("div.popup").css("visibility","hidden"))},b.closeError=function(){b.error=""},r(),$("#areaSearchInputSelect").focusout(function(){b.showAreaList=!1,b.selectedArea&&(b.selectedAreaInput||(b.selectedAreaInput={}),b.selectedAreaInput.AreaName=b.selectedArea.AreaName)}),b.showAreaListClicked=function(){b.showAreaList=!0,setTimeout(function(){$("#areaSearchInputSelect").select()},0)},b.removeProductFromComparison=function(b){var c=a.comparisonlist.indexOf(b);c>-1&&(a.comparisonlist.splice(c,1),m.set("comparisonlist",a.comparisonlist),t()),event.stopPropagation()},b.closeCompareDropDown=function(){},b.openCompareDropDown=function(){$("#compareDropDownMenu").css("display","block")},b.closeCartDropDown=function(){$(".dropdown-toggle").dropdown("toggle")},b.openCartDropDown=function(){$("#cartDropDownMenu").css("display","block")},$(".keep-open").on({"hide.bs.dropdown":function(){return!1}}),b.addProductToCart=function(b,d,e,f,g,h,i,j){var k=$("#img_"+b.ProductId);flyToElement($(k),$("#cartTopLink"));var l=v(b);if(!l){var o=A(b,d,e,f,g,h,i,j);null!=o?(a.flagLoggedIn&&n.addShoppingCartItem(c,o,a.userName).then(function(){}),a.cartlist.length||(a.cartlist=[]),a.cartlist.push(o),m.set("cartlist",a.cartlist),a.cartMessage="Success",w()):(a.cartFailureMessage="Failure",x())}u()};var A=function(a,b,c,d,e,f,g,h){if(a.StorePricingModel&&a.StorePricingModel.length>0){var i={};return i.ProductId=a.ProductId,i.Name=a.Name,i.PictureName=a.PictureName,i.SpecialPrice=e,i.Price=d,i.Branch=c,i.BranchId=b,i.StoresCount=a.StoresCount,i.FlagWishlist=a.FlagWishlist,i.Quantity=1,i.AdditionalShippingCharge=f,i.TotalAdditionalShippingCharge=f*i.Quantity,i.SubTotal=i.SpecialPrice*i.Quantity,i.SubTotalWithShipping=i.SpecialPrice*i.Quantity+i.TotalAdditionalShippingCharge,i.DeliveryTime=g,i.SelectedSize=h,i}var i={};return i.ProductId=a.ProductId,i.Name=a.Name,i.PictureName=a.PictureName,i.SpecialPrice=e,i.Price=d,i.Branch=c,i.BranchId=b,i.Quantity=1,i.AdditionalShippingCharge=f,i.TotalAdditionalShippingCharge=f*i.Quantity,i.SubTotal=i.SpecialPrice*i.Quantity,i.SubTotalWithShipping=i.SpecialPrice*i.Quantity+i.TotalAdditionalShippingCharge,i.DeliveryTime=g,i.SelectedSize=h,i};b.removeProductFromCart=function(b){for(var d=-1,e=0;e<a.cartlist.length;e++)a.cartlist[e].ProductId==b.ProductId&&(d=e);if(d>-1){var f=a.cartlist.splice(d,1);f.length>0&&a.flagLoggedIn&&n.removeShoppingCartItem(c,f[0],a.userName)}u(),event.stopPropagation()},b.gotoAnchor=function(){window.scrollTo(0,20)}}]),app.controller("OfferController",["$scope","$rootScope","$http","productService","userActionService",function(a,b,c,d,e){function f(){var b=document.getElementById("curLocation"),e=b.title,f=b.value;(null==e||""==e||"undefined"===e)&&(e=13.058312,f=80.21195),d.getAllOffers(a,c,e,f).then(function(b){a.products=b,a.messageOffers="",a.products.data&&0==a.products.data.length&&(a.messageOffers="No Offers in selected Area.")})}a.messageOffers="",f(),a.addProductWishlist=function(d){if(b.userName&&b.userName.length>0){var f=$("#img_"+d.ProductId);flyToElement($(f),$("#wishlistTopLink")),e.addUserWishlist(a,c,b.userName,d.ProductId).then(function(c){a.wishlist=c.data,d.FlagWishlist=!0,b.wishlistCount=c.data.length})}else $("#modal-container-Register").modal({show:!0})}}]),app.controller("CategoryController",["$scope","$http","categoryService",function(a,b,c){function d(){c.getAllCategory(a,b)}a.insertCategory=function(){c.insertCategory(a,b,a.newCategory),a.newCategory.Name="",a.newCategory.Description="",a.newCategory.MetaTitle=""},a.deleteCategory=function(d){c.deleteCategory(a,b,d)},d()}]),app.controller("LoginController",["$rootScope","$scope","$http","$cookieStore","$location","authService","userActionService","passwordService","localStorageService","Facebook","cartService",function(a,b,c,d,e,f,g,h,i,j,k){function l(){function d(){k.getShoppingCartItems(c,a.userName).then(function(b){if(b.data.length>0){a.cartlist=[];for(var c=0;c<b.data.length;c++){var d=f(b.data[c]);a.cartlist.push(d)}a.cartlist.length>0?i.set("cartlist",a.cartlist):a.cartlist=i.get("cartlist")||[]}e()})}function e(){a.cartTotal=0,b.totalShipping=0;for(var c=0;c<a.cartlist.length;c++)a.cartTotal=a.cartTotal+a.cartlist[c].SubTotal,b.totalShipping=b.totalShipping+a.cartlist[c].TotalAdditionalShippingCharge;i.set("cartlist",a.cartlist)}if(a.userName&&a.userName.length>0){g.getUserWishlist(b,c,a.userName).then(function(b){a.wishlistCount=b.data.length,a.wishlist=b.data}),g.getMyDetails(b,c,a.userName).then(function(c){b.curUser.Email=c.data.Email,b.curUser.PhoneNumber1=c.data.PhoneNumber1,b.curUser.FirstName=c.data.FirstName,b.curUser.LastName=c.data.LastName,a.curUserDisplayName=c.data.FirstName,c.data.Email&&(i.set("flagLoggedIn",a.flagLoggedIn),i.set("userName",b.userName),i.set("curUserDisplayName",a.curUserDisplayName))}),a.cartlist.length>0?k.addShoppingCartItemList(c,a.cartlist,a.userName).then(function(){d()}):d();var f=function(a){if(a.ProductId>0)var b={};return b.ProductId=a.ProductId,b.Name=a.Name,b.PictureName=a.PictureName,b.SpecialPrice=a.SpecialPrice,b.Price=a.Price,b.Branch=a.Branch,b.BranchId=a.BranchId,b.StoresCount=a.StoresCount,b.FlagWishlist=a.FlagWishlist,b.Quantity=a.Quantity,b.SelectedSize=a.selectedSize,b.AdditionalShippingCharge=a.AdditionalShippingCharge,b.TotalAdditionalShippingCharge=a.AdditionalShippingCharge*b.Quantity,b.SubTotal=b.SpecialPrice*b.Quantity,b.SubTotalWithShipping=b.SpecialPrice*b.Quantity+b.TotalAdditionalShippingCharge,b}}}function m(){i.remove("userName"),i.remove("flagLoggedIn"),i.remove("curUserDisplayName")}function n(a){g.RegisterUser(b,c,a).then(function(){b.savedSuccessfully=!0,b.message="User has been registered successfully.",b.loginData.userName=a.Email,b.loginData.password=a.Password,b.Login()},function(a){var c=[];for(var d in a.data.ModelState)for(var e=0;e<a.data.ModelState[d].length;e++)c.push(a.data.ModelState[d][e]);b.message="Failed to register user due to:"+c.join(" ")})}function o(a){j.api("/me",function(c){b.facebookUser=c,q(a)})}function p(){gapi.client&&gapi.client.request({path:"/plus/v1/people/me",method:"GET",callback:b.userInfoCallback})}function q(c){b.facebookUser.email&&f.loginWithFacebook(c,b.facebookUser.email).then(function(){a.flagLoggedIn=!0,a.userName=b.facebookUser.email,a.curUserDisplayName=b.facebookUser.name,l(),e.path()&&e.path("/Home"),$("#modal-container-Register").modal("hide")},function(c){b.message=c.error_description,a.flagLoggedIn=!1,m()})}function r(){b.googleUser.email&&f.loginWithGoogle(b.googleAuthToken,b.googleUser.email,b.expires_in,b.expires_at,b.token_type,b.issued_at).then(function(){a.flagLoggedIn=!0,a.userName=b.googleUser.email,a.curUserDisplayName=b.googleUser.name,l(),e.path()&&e.path("/Home"),$("#modal-container-Register").modal("hide")},function(c){b.message=c.error_description,a.flagLoggedIn=!1,m()})}b.savedSuccessfully=!1,b.loginData={userName:"",password:""},b.message="",b.curUser={},b.googleAuthToken="",b.googleUser={},b.Login=function(){f.login(b.loginData).then(function(){a.flagLoggedIn=!0,a.userName=b.loginData.userName,a.curUserDisplayName="",l(),("/Login"==e.path()||"/Register"==e.path())&&e.path("/Home"),$("#modal-container-Register").modal("hide")},function(c){b.message=c.error_description,a.flagLoggedIn=!1,m()})},b.RegisterUser=function(){var a={FirstName:b.user.FirstName,Email:b.user.Email,Password:b.user.Password,ConfirmPassword:b.user.ConfirmPassword,PhoneNumber1:b.user.PhoneNumber1};a.FirstName||(a.FirstName=b.user.Email),n(a)},b.facebookLoginStatus="disconnected",b.facebookIsReady=!1,b.connectUsingFacebook=function(){j.login(function(a){if(a.authResponse.accessToken){{o(a.authResponse.accessToken)}b.facebookLoginStatus=a.status}},{scope:"email,public_profile"})},b.processGoogleUserInfo=function(c){c&&!c.error&&(b.googleUser.email=c.emails[0].value,a.curUserDisplayName=c.displayName),r()},b.userInfoCallback=function(a){b.$apply(function(){b.processGoogleUserInfo(a)})},b.connectUsingGoogle=function(){gapi.client&&gapi.client.request({path:"/plus/v1/people/me",method:"GET",callback:b.userInfoCallback});var a={callback:"signinCallback",cookiepolicy:"single_host_origin",requestvisibleactions:"http://schemas.google.com/AddActivity",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email",width:"wide"};a.clientid="226533752513-k9omq9rlq9abj7dp363rmctoe736j4o8.apps.googleusercontent.com";var c=document.getElementById("scriptNewGoogle");c&&c.parentNode.removeChild(c);var d=document.createElement("script");d.id="scriptNewGoogle",d.type="text/javascript",d.async=!0,d.src="https://apis.google.com/js/client:plusone.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(d,e),gapi.signin.render("registerusingGoogle",a)},b.removeFacebookAuth=function(){j.api({method:"Auth.revokeAuthorization"},function(){j.getLoginStatus(function(a){b.facebookLoginStatus=a.status})})},b.$on("event:google-plus-signin-success",function(a,c){c.access_token&&(p(c.access_token),b.googleAuthToken=c.access_token,b.expires_in=c.expires_in,b.expires_at=c.expires_at,b.token_type=c.token_type,b.issued_at=c.issued_at)}),b.$on("event:google-plus-signin-failure",function(){}),b.$watch(function(){return j.isReady()},function(a){a&&(b.facebookIsReady=!0)}),b.SendForgetPassword=function(){h.forgotPassword(b,c,b.Email).then(function(a){0==a.data?(b.message="Sorry. Unable to identify user. Please verify provided email id",b.successfullySent=!1):(b.message="A link has been sent to your mail to reset the password",b.successfullySent=!0)})}}]),app.controller("ChangePasswordController",["$rootScope","$scope","$http","$routeParams","passwordService",function(a,b,c,d,e){b.message="",b.user={},b.user.userName=a.userName,b.ChangePassword=function(){b.message="",b.user.NewPassword===b.user.ConfirmPassword?e.changePassword(b,c,b.user.userName,b.user.CurrentPassword,b.user.NewPassword).then(function(a){1==a.data?(b.savedSuccessfully=!0,b.message="Password has been changed Successfully."):(b.savedSuccessfully=!1,b.message="Error in updating Password")},function(a){b.message=a.error_description}):(b.savedSuccessfully=!1,b.message="Password mismatch")}}]),app.controller("MyAccountController",["$rootScope","$scope","$http","$routeParams","authService","userActionService",function(a,b,c,d,e,f){function g(){f.getMyDetails(b,c,b.user.userName).then(function(a){b.user.Email=a.data.Email,b.user.PhoneNumber1=a.data.PhoneNumber1,b.user.FirstName=a.data.FirstName,b.user.LastName=a.data.LastName})}b.user={},b.user.userName=a.userName,g()}]),app.controller("orderTrackingController",["$rootScope","$scope","$http","$routeParams","orderTrackingService","authInterceptorService",function(a,b,c,d,e){function f(){e.getTrackingOrders(b,c).then(function(a){b.TrackOrdersList=a.data},function(){}),e.GetOrdersList(b,c).then(function(a){b.TotalOrdersList=a.data},function(){}),b.message="",b.model="Order Details"}function g(){e.getTrackingOrders(b,c).then(function(a){b.TrackOrdersList=a.data},function(){})}b.TrackOrdersList={},b.TotalOrdersList={},b.TotalProductList={},b.ProductList={},f(),b.OrderPagination=function(a){var d=a;e.PagingOrders(b,c,d).then(function(a){b.TrackOrdersList=a.data},function(){})},b.orderedProducts=function(a){b.ProductList=null;var d=(b.model,a.Id);e.GetProductList(b,c,d).then(function(a){b.ProductList=a.data},function(){})},b.CancelOrders=function(a){var d=window.confirm("Are you sure you want to Cancel Order? \n Order Number : "+a.Id+"\n Number of products: "+a.NumberOfProducts+"\n Order Status: "+a.OrderStatus+"\n Order Total: "+a.OrderTotal);if(d){var f=a.Id;e.CancelOrders(b,c,f).then(function(a){a.data===!0?(b.savedSuccessfully=!0,b.message="Order Number "+f+" Cancelled",g()):(b.savedSuccessfully=!1,b.message="Error Cancelled "+f)},function(){})}},b.getISTDate=function(a){var b=new Date(a+"Z");return b},b.SearchOrders=function(a){var d=a.OrderId;null==d&&(d=0),d>0?e.SearchOrders(b,c,d).then(function(a){b.TrackOrdersList=a.data},function(){}):f()}}]),app.controller("ProductController",["$rootScope","$scope","$http","$routeParams","$timeout","$cookieStore","productService","mapService","userActionService","localStorageService","cartService","breadcrumbs",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){o(F,G),s(),t(),u(),n()}function n(){i.getMyDetails(b,c,a.userName).then(function(c){a.flagLoggedIn&&(b.contactData.Email=c.data.Email,b.contactData.Mobile=c.data.PhoneNumber1,b.contactData.Name=c.data.FirstName)})}function o(a,d){g.getProductDetails(b,c,b.productId,b.locationBased,a,d,b.searchRadius).then(function(c){b.product=c,b.imgSrc=b.product.data.PictureName,q(),v(),p(),z(a,d),H(b.product.data)})}function p(){for(var c=a.wishlist,d=0;d<c.length;d++)b.product.data.ProductId==c[d].Product&&(b.product.data.FlagWishlist=!0)}function q(){if(null!=b.product&&null!=b.product.data&&null!=b.product.data.StorePricingModel)for(var a=0;a<b.product.data.StorePricingModel.length;a++)b.product.data.StorePricingModel[a].Distance=r(b.product.data.StorePricingModel[a].Latitude,b.product.data.StorePricingModel[a].Longitude)}function r(a,b){var c=D.title,d=D.value,e=Math.PI*c/180,f=Math.PI*a/180,g=(Math.PI*d/180,Math.PI*b/180,d-b),h=Math.PI*g/180,i=Math.sin(e)*Math.sin(f)+Math.cos(e)*Math.cos(f)*Math.cos(h);return i=Math.acos(i),i=180*i/Math.PI,i=60*i*1.1515,i=1.609344*i}function s(){g.getProductSpecification(b,c,b.productId).then(function(a){b.productSpecification=a})}function t(){g.getProductKeyFeatures(b,c,b.productId).then(function(a){b.productKeyFeatures=a})}function u(){g.getRatings(b,c,b.productId).then(function(a){var c=I(a.data);b.productRating=c.toFixed(1)})}function v(){b.messageProductPricing="",b.product.data&&b.product.data.StorePricingModel&&0!=b.product.data.StorePricingModel||(b.messageProductPricing="Stores not available for this product in selected area. 1) Increase the KM radius of the map or 2) Drag Vbuy.in icon in center of the map and search nearby areas in map. ")}function w(){b.map.setZoom(b.searchRadius<21?E[b.searchRadius]:10)}function x(a,d){g.getProductDetails(b,c,b.productId,b.locationBased,a,d,b.searchRadius).then(function(a){b.product=a,q(),v()})}function y(a,d){h.getStoreLocationsForProduct(b,c,b.productId,a,d,b.searchRadius).then(function(a){b.storeLocations=a,b.storeLocations.data.length>0?B():A()})}function z(a,c){var d=document.getElementById("map_canvas");if(null!=d&&""!=d.value){var e={url:"Content/images/VBuy_map32.png",size:new google.maps.Size(32,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(18,56)},f={center:new google.maps.LatLng(a,c),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,panControl:!1,streetViewControl:!1,zoomControl:!0,scrollwheel:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};b.map=new google.maps.Map(document.getElementById("map_canvas"),f);var g=new google.maps.Marker({position:new google.maps.LatLng(a,c),map:b.map,icon:e,draggable:!0,title:"Selected Area!.\n Drag to change center"});b.circle=new google.maps.Circle({center:new google.maps.LatLng(a,c),radius:1e3*b.searchRadius,strokeColor:"#138808",fillColor:"#FF9933",fillOpacity:.1,strokeOpacity:.8,strokeWeight:2,map:b.map}),y(a,c),google.maps.event.addListener(g,"drag",function(a){var c=a.latLng.lat(),d=a.latLng.lng();b.circle.setCenter(new google.maps.LatLng(c,d))}),google.maps.event.addListener(g,"dragend",function(a){var c=a.latLng.lat(),d=a.latLng.lng();b.map.setCenter(new google.maps.LatLng(c,d)),b.circle.setCenter(new google.maps.LatLng(c,d)),A(),y(c,d),x(c,d),D.title=c,D.value=d
}),google.maps.event.clearListeners(window,"resize"),w()}}function A(){for(var a=0;a<b.markers.length;a++)b.markers[a].setMap(null)}function B(){var a=new google.maps.InfoWindow({content:"loading"});A();for(var c=0;c<b.storeLocations.data.length;c++){var d=b.storeLocations.data[c].StoreName,e=d;d.length>8&&(e=d.substring(0,7)+"..");var f=new StyledIcon(StyledIconTypes.MARKER,{color:"#FF9933",fore:"#000080",text:e});5>c&&(f=new StyledIcon(StyledIconTypes.BUBBLE,{color:"#FF9933",fore:"#000080",text:e}));var g=new StyledMarker({map:b.map,styleIcon:f,animation:google.maps.Animation.DROP,labelClass:"maplabels",labelStyle:{opacity:.75},labelContent:b.storeLocations.data[c].StoreName,title:b.storeLocations.data[c].StoreName,position:new google.maps.LatLng(b.storeLocations.data[c].Latitude,b.storeLocations.data[c].Longitude),html:'<a href="/stores/branch/'+b.storeLocations.data[c].BranchId+'"><p><strong>'+b.storeLocations.data[c].BranchName+"</strong><br/>"+b.storeLocations.data[c].Address1+" , "+b.storeLocations.data[c].Address2+"</p></a>"});b.markers.push(g),google.maps.event.addListener(g,"click",function(){a.setContent(this.html),a.open(b.map,this)})}}function C(){a.comparisonlistProductId.splice(0,a.comparisonlistProductId.length);for(var b=0;b<a.comparisonlist.length;b++)a.comparisonlistProductId.push(a.comparisonlist[b].ProductId)}b.markers=[];var D=document.getElementById("curLocation");b.searchRadius=a.defaultRadius,b.messageProductPricing="",b.productRating=0,b.contactData={},b.contactData.message="",b.imgSrc="",b.storeSortBy="SpecialPrice",b.reverse=!1,b.selectedVariant="",b.product={},b.product.data={},b.product.data.RelatedProductList={},l.options={Product:d.friendlyUrl};var E={1:14,2:14,3:14,4:13,5:13,6:12,7:12,8:12,9:12,10:12,11:11,12:11,13:11,14:11,15:11,16:11,17:11,18:11,19:11,20:11};null!=d.lat&&null!=d.lng&&(D.title=d.lat,D.value=d.lng);var F=D.title,G=D.value;(null==F||""==F||"undefined"===F)&&(F=13.058312,G=80.21195),b.storeLocations=[],b.locationBased=!0,b.productId=d.productId?parseInt(d.productId):0;var H=function(b){for(var c=!1,d=0;d<a.recentlyViewedlist.length;d++)b.ProductId==a.recentlyViewedlist[d].ProductId&&(c=!0);if(!c){var e=J(b);a.recentlyViewedlist.length>=20&&a.recentlyViewedlist.splice(0,2),a.recentlyViewedlist.push(e),j.set("recentlyViewedlist",a.recentlyViewedlist)}};b.onProductRatingChanged=function(a){b.userName&&b.userName.length>0?g.updateRatings(b,c,b.userName,b.productId,a).then(function(a){var c=I(a.data);b.productRating=c.toFixed(1)}):(u(),$("#modal-container-Register").modal({show:!0}))};var I=function(a){for(var b=0,c=0,d=0;d<a.length;d++)b+=a[d].Rating*a[d].RatingCount,c+=a[d].RatingCount;return b/c};b.onProductFilterChanged=function(){var c=D.title,d=D.value;a.defaultRadius=b.searchRadius,x(c,d),y(c,d),b.circle.radius=1e3*b.searchRadius,b.circle.map=b.map,b.circle.setCenter(new google.maps.LatLng(c,d)),w()},m(),b.GetDirection=function(a){var c=D.title,d=D.value,e=a.Latitude,f=a.Longitude,g=new google.maps.LatLng(c,d),h=new google.maps.LatLng(e,f);null!=b.directionsDisplay&&(b.directionsDisplay.setMap(null),b.directionsDisplay=null),b.directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0}),b.directionsDisplay.setMap(b.map);var i={origin:g,destination:h,travelMode:google.maps.TravelMode.DRIVING};directionsService=new google.maps.DirectionsService,directionsService.route(i,function(a,c){c==google.maps.DirectionsStatus.OK&&b.directionsDisplay.setDirections(a)})},b.BuyProduct=function(){return!1},b.ContactSeller=function(a,d,f){return a.message="",a.Mobile&&10==a.Mobile.toString().length?a&&d&&f&&g.contactSeller(b,c,a.Name,a.Email,a.Mobile,a.Subject,d,f).then(function(b){"failed"===b.data?(a.savedSuccessfully=!1,a.message=" You can only sent one message to the store for same product in 2 hours."):"OK"==b.statusText?(a.savedSuccessfully=!0,a.message="Message Sent",e(function(){a.message=""},4e3)):(a.savedSuccessfully=!1,a.message="Sorry. Please resend the details.")}):(a.savedSuccessfully=!1,a.message=" Mobile number should be 10 digits"),!1},b.ChangeProductDisplayImage=function(a){b.imgSrc=a},b.addToProductComparison=function(c){var d=$("#img_"+c.ProductId);if(a.comparisonlist.length>=4)return void(b.message="Only 4 products can be compared.");flyToElement($(d),$("#compareTopLink"));var e=J(c);a.comparisonlist.length<4&&(a.comparisonlist.push(e),j.set("comparisonlist",a.comparisonlist),C())},b.addProductWishlist=function(d){if(b.userName&&b.userName.length>0){var e=$("#img_"+d.ProductId);flyToElement($(e),$("#wishlistTopLink")),i.addUserWishlist(b,c,b.userName,d.ProductId).then(function(b){a.wishlist=b.data,d.FlagWishlist=!0,a.wishlistCount=b.data.length})}else $("#modal-container-Register").modal({show:!0})};var J=function(a){var b={};return b.ProductId=a.ProductId,b.Name=a.Name,b.PictureName=a.PictureName,b.SpecialPrice=a.StorePricingModel[0].SpecialPrice,b.Price=a.StorePricingModel[0].Price,b.StoresCount=a.StoresCount,b.FlagWishlist=a.FlagWishlist,b};b.removeFromProductComparison=function(b){var c=$("#img_"+b.ProductId);flyToElement($("#compareTopLink"),$(c));for(var d=-1,e=0;e<a.comparisonlist.length;e++)a.comparisonlist[e].ProductId==b.ProductId&&(d=e);d>-1&&(a.comparisonlist.splice(d,1),j.set("comparisonlist",a.comparisonlist),C())},b.updateSelectedVariant=function(a){b.selectedVariant=a}}]),app.controller("CompareController",["$rootScope","$scope","$http","$routeParams","$cookieStore","localStorageService","$timeout","productService","userActionService","breadcrumbs",function(a,b,c,d,e,f,g,h){function i(){j(),k()}function j(){b.comparisonProductlist=a.comparisonlist;var d=new Array;for(prd in b.comparisonProductlist)d.push(b.comparisonProductlist[prd].ProductId);h.compareProduct(b,c,d).then(function(a){a.data&&(b.productComparisonResult=a.data)})}function k(){b.comparisonProductlist=a.comparisonlist;var d=new Array;for(prd in b.comparisonProductlist)d.push(b.comparisonProductlist[prd].ProductId);h.compareProductDetailedSpecification(b,c,d).then(function(a){a.data&&(b.productDetailedComparisonResult=a.data)})}b.comparisonProductlist=[],b.productComparisonResult={},b.productDetailedComparisonResult={},i(),b.removeProductInComparisonPage=function(b){var c=a.comparisonlist.indexOf(b);c>-1&&(a.comparisonlist.splice(c,1),f.set("comparisonlist",a.comparisonlist),l(),i())};var l=function(){b.comparisonProductlist=[],b.productComparisonResult={},b.productDetailedComparisonResult={}};b.$watch(function(){return a.comparisonlist},function(){l(),i()},!0)}]),app.controller("ProductListController",["$rootScope","$scope","$http","$routeParams","$cookieStore","localStorageService","productService","mapService","userActionService","$modal","authService","breadcrumbs",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){b.map.setZoom(b.searchRadius<21?w[b.searchRadius]:10)}function n(){p(),o(y,z),q()}function o(a,d){g.getProducts(b,c,b.categoryId,null,a,d,b.searchRadius,b.priceRangeFrom,b.priceRangeTo,1,b.itemsPerPage).then(function(a){b.products=a,b.products.data.length>0&&(b.products.totalCount=b.products.data[0].TotalCount,b.productDataLength=b.products.data.length),b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength;var c=navigator.onLine;c&&t(y,z)})}function p(){g.getMinMaxForProductCategory(b,c,b.categoryId).then(function(a){b.searchFilter=a,b.searchFilter.data.Max>0||(b.searchFilter.data.Min=0,b.searchFilter.data.Max=1e5),b.loadPriceRangeSlider=!0}),g.getFiltersForProductCategory(b,c,b.categoryId).then(function(a){b.productFilterList=a,b.productFilterGroup={},b.productFilterGroup=_.groupBy(b.productFilterList.data,"FilterParameter");for(var c in b.productFilterGroup)b.productFilterGroup[c].SelectedProductFilter=[]})}function q(){a.comparisonlistProductId.splice(0,a.comparisonlistProductId.length);for(var b=0;b<a.comparisonlist.length;b++)a.comparisonlistProductId.push(a.comparisonlist[b].ProductId)}function r(a,d){var e=(b.searchRadius,[]);for(var f in b.productFilterGroup)if(b.productFilterGroup[f].SelectedProductFilter)for(var h=0;h<b.productFilterGroup[f].SelectedProductFilter.length;h++)e.push({FilterParameter:b.productFilterGroup[f].SelectedProductFilter[h].FilterParameter,FilterValueText:b.productFilterGroup[f].SelectedProductFilter[h].FilterValueText});g.getProducts(b,c,b.categoryId,b.selectedFilter,a,d,b.searchRadius,b.priceRangeFrom,b.priceRangeTo,1,b.itemsPerPage,e).then(function(a){b.products=a,b.products.data.length>0?(b.products.totalCount=b.products.data[0].TotalCount,b.productDataLength=b.products.data.length,b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength):b.products.totalCount=0,b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength})}function s(a,d){h.getStoreLocationsForCategory(b,c,b.categoryId,a,d,b.searchRadius,b.priceRangeFrom,b.priceRangeTo).then(function(a){b.storeLocations=a,b.storeLocations.data.length>0?v():u()})}function t(a,c){var d={center:new google.maps.LatLng(a,c),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,panControl:!1,streetViewControl:!1,zoomControl:!0,scrollwheel:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}},e={url:"Content/images/VBuy_map32.png",size:new google.maps.Size(32,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(18,56)};b.map=new google.maps.Map(document.getElementById("map_canvassmall"),d);var f=new google.maps.Marker({position:new google.maps.LatLng(a,c),map:b.map,draggable:!0,icon:e,title:"Selected Area!.\n Drag to change center"});b.circle=new google.maps.Circle({center:new google.maps.LatLng(a,c),radius:1e3*b.searchRadius,strokeColor:"#138808",fillColor:"#FF9933",fillOpacity:.1,strokeOpacity:.8,strokeWeight:2,map:b.map}),s(a,c),google.maps.event.addListener(f,"drag",function(a){var c=a.latLng.lat(),d=a.latLng.lng();b.circle.setCenter(new google.maps.LatLng(c,d))}),google.maps.event.addListener(f,"dragend",function(a){var c=a.latLng.lat(),d=a.latLng.lng();u(),b.map.setCenter(new google.maps.LatLng(c,d)),b.circle.setCenter(new google.maps.LatLng(c,d)),s(c,d),r(c,d),x.title=c,x.value=d}),google.maps.event.clearListeners(window,"resize"),m()}function u(){for(var a=0;a<b.markers.length;a++)b.markers[a].setMap(null)}function v(){var a=new google.maps.InfoWindow({content:"loading"});u();for(var c=0;c<b.storeLocations.data.length;c++){var d=b.storeLocations.data[c].StoreName,e=d;d.length>8&&(e=d.substring(0,7)+"..");var f=new StyledIcon(StyledIconTypes.MARKER,{color:"#FF9933",fore:"#000080",text:e});5>c&&(f=new StyledIcon(StyledIconTypes.BUBBLE,{color:"#FF9933",fore:"#000080",text:e}));var g=new StyledMarker({map:b.map,styleIcon:f,animation:google.maps.Animation.DROP,labelClass:"maplabels",labelStyle:{opacity:.75},labelContent:b.storeLocations.data[c].StoreName,title:b.storeLocations.data[c].StoreName,position:new google.maps.LatLng(b.storeLocations.data[c].Latitude,b.storeLocations.data[c].Longitude),html:'<a href="/stores/branch/'+b.storeLocations.data[c].BranchId+'"><p><strong>'+b.storeLocations.data[c].BranchName+"</strong><br/>"+b.storeLocations.data[c].Address1+" , "+b.storeLocations.data[c].Address2+"</p></a>"});b.markers.push(g),google.maps.event.addListener(g,"click",function(){a.setContent(this.html),a.open(b.map,this)})}}b.markers=[],b.searchRadius=a.defaultRadius,b.priceRangeFrom=0,b.priceRangeTo=1e5,b.priceRange=[b.priceRangeFrom,b.priceRangeTo],b.itemsPerPage=50,b.showLoadMore=!1,b.productDataLength=0,b.searchFilter={},b.searchFilter.data={},b.searchFilter.data.Min=0,b.searchFilter.data.Max=1e5,b.loadPriceRangeSlider=!1,b.message="",b.productFilterGroup={},b.selectedFilter={},b.selectedFilter.SelectedBrandList=[],b.selectedFilter.SelectedProductFilter1=[],b.dropdownBrandSettings={enableSearch:!0,scrollableHeight:"300px",scrollable:!0,displayProp:"BrandName",idProp:"Id",externalIdProp:"Id",smartButtonMaxItems:2},b.selectedFilter.SortBy={},b.dropdownSortData=[{id:1,label:"Stores Count"},{id:2,label:"Low Price"},{id:3,label:"High Price"},{id:4,label:"A to Z"},{id:5,label:"Z to A"}],b.dropdownSortSettings={scrollableHeight:"200px",scrollable:!0,displayProp:"label",idProp:"id",externalIdProp:"id",smartButtonMaxItems:1,selectionLimit:1,showUncheckAll:!0},b.dropdownProductFilterSettings={enableSearch:!0,scrollableHeight:"300px",scrollable:!0,displayProp:"FilterValueText",idProp:"FilterValueText",externalIdProp:"",showUncheckAll:!0,showCheckAll:!1,enableSearch:!1,smartButtonMaxItems:2},b.dropdownBrandEvents={onItemSelect:function(){b.onPricingFilterChanged()},onItemDeselect:function(){b.onPricingFilterChanged()},onDeselectAll:function(){b.selectedFilter.SortBy={},b.onPricingFilterChanged()}},b.dropdownProductFilterEvents={onItemSelect:function(){b.onPricingFilterChanged()},onItemDeselect:function(){b.onPricingFilterChanged()},onDeselectAll:function(){b.selectedFilter.SortBy={},b.onPricingFilterChanged()}},b.filterBrandCustomTexts={buttonDefaultText:"Brand"},b.filterSortCustomTexts={buttonDefaultText:"Sort By",uncheckAll:"Clear Sorting"},l.options={Category:d.friendlyUrl};var w={1:14,2:14,3:14,4:13,5:13,6:12,7:12,8:12,9:12,10:12,11:11,12:11,13:11,14:11,15:11,16:11,17:11,18:11,19:11,20:11},x=document.getElementById("curLocation");null!=d.lat&&null!=d.lng&&(x.title=d.lat,x.value=d.lng);var y=x.title,z=x.value;(null==y||""==y||"undefined"===y)&&(y=13.058312,z=80.21195),b.storeLocations=[],b.categoryId=d.categoryId?parseInt(d.categoryId):0,b.searchedCategoryName=d.friendlyUrl,b.onPricingFilterChanged=function(){var a=x.title,c=x.value;b.productDataLength=0,r(a,c),s(a,c)},b.onProductFilterChanged=function(){var c=x.title,d=x.value;b.productDataLength=0,a.defaultRadius=b.searchRadius,r(c,d),s(c,d),b.circle.radius=1e3*b.searchRadius,b.circle.map=b.map,b.circle.setCenter(new google.maps.LatLng(c,d)),m()},b.showMap=function(){$("#modal-container-map").on("shown.bs.modal",function(){var a=x.title,c=x.value;window.setTimeout(function(){google.maps.event.trigger(b.map,"resize"),b.map.setCenter(new google.maps.LatLng(a,c))},0)}),$("#modal-container-map").modal("show")},n(),b.addProductWishlist=function(d){if(b.userName&&b.userName.length>0){var e=$("#img_"+d.ProductId);flyToElement($(e),$("#wishlistTopLink")),i.addUserWishlist(b,c,b.userName,d.ProductId).then(function(c){b.wishlist=c.data,a.wishlist=c.data,d.FlagWishlist=!0,a.wishlistCount=c.data.length})}else $("#modal-container-Register").modal({show:!0})},b.addToProductComparison=function(c){var d=$("#img_"+c.ProductId);if(a.comparisonlist.length>=4)return void(b.message="Only 4 products can be compared.");flyToElement($(d),$("#compareTopLink"));var e=A(c);a.comparisonlist.length<4&&(a.comparisonlist.push(e),f.set("comparisonlist",a.comparisonlist),q())};var A=function(a){var b={};return b.ProductId=a.ProductId,b.Name=a.Name,b.PictureName=a.PictureName,b.SpecialPrice=a.SpecialPrice,b.Price=a.Price,b.StoresCount=a.StoresCount,b.FlagWishlist=a.FlagWishlist,b};b.removeFromProductComparison=function(b){var c=$("#img_"+b.ProductId);flyToElement($("#compareTopLink"),$(c));for(var d=-1,e=0;e<a.comparisonlist.length;e++)a.comparisonlist[e].ProductId==b.ProductId&&(d=e);d>-1&&(a.comparisonlist.splice(d,1),f.set("comparisonlist",a.comparisonlist),q())},b.loadMore=function(){var a=x.title,d=x.value,e=b.searchRadius,f=[];if(b.showLoadMore){for(var h in b.productFilterGroup)if(b.productFilterGroup[h].SelectedProductFilter)for(var i=0;i<b.productFilterGroup[h].SelectedProductFilter.length;i++)f.push({FilterParameter:b.productFilterGroup[h].SelectedProductFilter[i].FilterParameter,FilterValueText:b.productFilterGroup[h].SelectedProductFilter[i].FilterValueText});g.getProducts(b,c,b.categoryId,b.selectedFilter,a,d,e,b.priceRangeFrom,b.priceRangeTo,b.products.data.length+1,b.itemsPerPage,f).then(function(a){for(i=0;i<a.data.length;i++)b.products.data.push(a.data[i]);b.productDataLength=b.products.data.length,b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength,b.loadBusy=!1}),b.loadBusy=!1}},b.clearFilter=function(){if(b.productFilterGroup){for(var a in b.productFilterGroup)b.productFilterGroup[a].SelectedProductFilter=[];b.selectedFilter.SelectedBrandList=[],b.onPricingFilterChanged()}},b.loadBusy=!1,$(window).scroll(function(){var a,c,d,e,f=document.getElementById("productListDiv");e=$(window).height()+$(window).scrollTop(),f&&(a=f.offsetTop+f.scrollHeight,c=a-e,d=c<=1*$(window).height(),d&&!b.loadBusy&&(b.loadMore(),b.loadBusy=!0))})}]),app.controller("ResetPasswordController",["$scope","$location","$http","$rootScope","$routeParams","passwordService",function(a,b,c,d,e,f){function g(){a.uid=e.uid,a.username=e.username}a.message="",g(),a.ResetPassword=function(){a.message="",a.user.Password===a.user.ConfirmPassword?f.resetPassword(a,c,a.username,a.user.Password).then(function(b){1==b.data?(a.savedSuccessfully=!0,a.message="Password has been changed Successfully."):(a.savedSuccessfully=!1,a.message="Error in updating Password")},function(b){a.message=b.error_description}):(a.savedSuccessfully=!1,a.message="Password mismatch")}}]),app.controller("SearchProductsController",["$rootScope","$scope","$http","$routeParams","$q","$cookieStore","productService","mapService","userActionService","$location","breadcrumbs",function(a,b,c,d,e,f,g,h,j){function k(){l(),m(w,x)}function l(){g.getMinMaxForProductSearch(b,c,d.productFilter).then(function(a){b.searchFilter=a,b.searchFilter.data.Max>0||(b.searchFilter.data.Min=0,b.searchFilter.data.Max=1e5),b.loadPriceRangeSlider=!0})}function m(a,f){var h=g.searchCatalogue(b,c,e,d.productFilter,null,a,f,b.searchRadius,b.priceRangeFrom,b.priceRangeTo,1,b.itemsPerPage);b.searchProductRequests.push(h),h.promise.then(function(a){b.products=a,b.products.data.length>0&&(b.productDataLength=b.products.data.length,b.products.totalCount=b.products.data[0].TotalCount),b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength;var c=navigator.onLine;c&&q(w,x)},function(){})}function n(){b.map.setZoom(b.searchRadius<21?u[b.searchRadius]:10)}function o(a,f){b.searchProductRequests=[];var h=g.searchCatalogue(b,c,e,d.productFilter,b.selectedFilter,a,f,b.searchRadius,b.priceRangeFrom,b.priceRangeTo,1,b.itemsPerPage);b.searchProductRequests.push(h),h.promise.then(function(a){b.products=a,b.products.data.length>0?(b.products.totalCount=b.products.data[0].TotalCount,b.productDataLength=b.products.data.length):b.products.totalCount=0,b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength},function(){})}function p(a,e){h.getStoreLocationsForSearch(b,c,d.productFilter,a,e,b.searchRadius,b.priceRangeFrom,b.priceRangeTo).then(function(a){b.storeLocations=a,b.storeLocations.data.length>0&&s()})}function q(a,c){var e={center:new google.maps.LatLng(a,c),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,panControl:!1,streetViewControl:!1,zoomControl:!0,scrollwheel:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}},f={url:"Content/images/VBuy_map32.png",size:new google.maps.Size(32,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(18,56)};b.map=new google.maps.Map(document.getElementById("map_canvassmall"),e);var g=new google.maps.Marker({position:new google.maps.LatLng(a,c),map:b.map,draggable:!0,icon:f,title:"Selected Area!.\n Drag to change center"});b.circle=new google.maps.Circle({center:new google.maps.LatLng(a,c),radius:1e3*b.searchRadius,strokeColor:"#138808",fillColor:"#FF9933",fillOpacity:.1,strokeOpacity:.8,strokeWeight:2,map:b.map}),p(a,c),google.maps.event.addListener(g,"drag",function(a){var c=a.latLng.lat(),d=a.latLng.lng();b.circle.setCenter(new google.maps.LatLng(c,d))}),google.maps.event.addListener(g,"dragend",function(a){var c=a.latLng.lat(),e=a.latLng.lng();r(),b.map.setCenter(new google.maps.LatLng(c,e)),b.circle.setCenter(new google.maps.LatLng(c,e)),p(c,e),o(c,e),v.title=c,v.value=e;({productFilter:d.productFilter,lat:v.title,lng:v.value})}),google.maps.event.clearListeners(window,"resize"),n()}function r(){for(var a=0;a<b.markers.length;a++)b.markers[a].setMap(null)}function s(){var a=new google.maps.InfoWindow({content:"loading"});r();for(var c=0;c<b.storeLocations.data.length;c++){var d=b.storeLocations.data[c].StoreName,e=d;d.length>8&&(e=d.substring(0,7)+"..");var f=new StyledIcon(StyledIconTypes.MARKER,{color:"#FF9933",fore:"#000080",text:e});5>c&&(f=new StyledIcon(StyledIconTypes.BUBBLE,{color:"#FF9933",fore:"#000080",text:e}));var g=new StyledMarker({map:b.map,styleIcon:f,animation:google.maps.Animation.DROP,labelClass:"maplabels",labelStyle:{opacity:.75},labelContent:b.storeLocations.data[c].StoreName,title:b.storeLocations.data[c].StoreName,position:new google.maps.LatLng(b.storeLocations.data[c].Latitude,b.storeLocations.data[c].Longitude),html:"<p><strong>"+b.storeLocations.data[c].BranchName+"</strong><br/>"+b.storeLocations.data[c].Address1+" , "+b.storeLocations.data[c].Address2+"</p>"});b.markers.push(g),google.maps.event.addListener(g,"click",function(){a.setContent(this.html),a.open(b.map,this)})}}function t(){a.comparisonlistProductId.splice(0,a.comparisonlistProductId.length);for(var b=0;b<a.comparisonlist.length;b++)a.comparisonlistProductId.push(a.comparisonlist[b].ProductId)}b.markers=[],b.searchedProduct=d.productFilter,b.searchedArea=d.areaName,b.searchRadius=a.defaultRadius,b.priceRangeFrom=0,b.priceRangeTo=1e5,b.priceRange=[b.priceRangeFrom,b.priceRangeTo],b.itemsPerPage=50,b.productDataLength=0,b.searchFilter={},b.searchFilter.data={},b.searchFilter.data.Min=0,b.searchFilter.data.Max=1e5,b.loadPriceRangeSlider=!1,b.selectedFilter={},b.selectedFilter.SelectedBrandList=[],b.dropdownBrandSettings={enableSearch:!0,scrollableHeight:"300px",scrollable:!0,displayProp:"BrandName",idProp:"Id",externalIdProp:"Id",smartButtonMaxItems:2},b.selectedFilter.SortBy={},b.dropdownSortData=[{id:1,label:"Stores Count"},{id:2,label:"Low Price"},{id:3,label:"High Price"},{id:4,label:"A to Z"},{id:5,label:"Z to A"}],b.dropdownSortSettings={scrollableHeight:"200px",scrollable:!0,displayProp:"label",idProp:"id",externalIdProp:"id",smartButtonMaxItems:1,selectionLimit:1,showUncheckAll:!0},b.dropdownBrandEvents={onItemSelect:function(){setTimeout(function(){b.onPricingFilterChanged()},1e3)},onItemDeselect:function(){setTimeout(function(){b.onPricingFilterChanged()},1e3)},onDeselectAll:function(){b.selectedFilter.SortBy={},b.onPricingFilterChanged()}},b.filterBrandCustomTexts={buttonDefaultText:"Brand"},b.filterSortCustomTexts={buttonDefaultText:"Sort By",uncheckAll:"Clear Sorting"};var u={1:14,2:14,3:14,4:13,5:13,6:12,7:12,8:12,9:12,10:12,11:11,12:11,13:11,14:11,15:11,16:11,17:11,18:11,19:11,20:11},v=document.getElementById("curLocation");null!=d.lat&&null!=d.lng&&(v.title=d.lat,v.value=d.lng);var w=v.title,x=v.value;(null==w||""==w||"undefined"===w)&&(w=13.058312,x=80.21195),b.storeLocations=[],b.onPricingFilterChanged=function(){var a=v.title,c=v.value;b.productDataLength=0,o(a,c),p(a,c)},b.onProductFilterChanged=function(){var a=v.title,c=v.value;b.productDataLength=0,b.$parent.defaultRadius=b.searchRadius,o(a,c),p(a,c),b.circle.radius=1e3*b.searchRadius,b.circle.map=b.map,b.circle.setCenter(new google.maps.LatLng(a,c)),n()},b.searchProductRequests=[];b.showMap=function(){$("#modal-container-map").on("shown.bs.modal",function(){var a=v.title,c=v.value;window.setTimeout(function(){google.maps.event.trigger(b.map,"resize"),b.map.setCenter(new google.maps.LatLng(a,c))},0)}),$("#modal-container-map").modal("show")},k(),b.addProductWishlist=function(d){if(b.userName&&b.userName.length>0){var e=$("#img_"+d.ProductId);flyToElement($(e),$("#wishlistTopLink")),j.addUserWishlist(b,c,b.userName,d.ProductId).then(function(c){b.wishlist=c.data,d.FlagWishlist=!0,a.wishlistCount=c.data.length})}else $("#modal-container-Register").modal({show:!0})},b.addToProductComparison=function(c){var d=$("#img_"+c.ProductId);if(a.comparisonlist.length>=4)return void(b.message="Only 4 products can be compared.");flyToElement($(d),$("#compareTopLink"));var e=y(c);a.comparisonlist.length<4&&(a.comparisonlist.push(e),f.put("comparisonlist",a.comparisonlist),t())};var y=function(a){var b={};return b.ProductId=a.ProductId,b.Name=a.Name,b.PictureName=a.PictureName,b.SpecialPrice=a.SpecialPrice,b.Price=a.Price,b.StoresCount=a.StoresCount,b.FlagWishlist=a.FlagWishlist,b};b.removeFromProductComparison=function(b){var c=$("#img_"+b.ProductId);flyToElement($("#compareTopLink"),$(c));for(var d=-1,e=0;e<a.comparisonlist.length;e++)a.comparisonlist[e].ProductId==b.ProductId&&(d=e);d>-1&&(a.comparisonlist.splice(d,1),f.put("comparisonlist",a.comparisonlist),t())},b.loadMore=function(){var a=v.title,f=v.value,h=(b.searchRadius,g.searchCatalogue(b,c,e,d.productFilter,b.selectedFilter,a,f,b.searchRadius,b.priceRangeFrom,b.priceRangeTo,b.products.data.length+1,b.itemsPerPage));b.searchProductRequests.push(h),h.promise.then(function(a){for(i=0;i<a.data.length;i++)b.products.data.push(a.data[i]);b.productDataLength=b.products.data.length,b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength},function(){})}}]),app.controller("UserWishlistController",["$rootScope","$scope","$http","$routeParams","productService","mapService","userActionService","$modal","authService",function(a,b,c,d,e,f,g,h){function j(){b.map.setZoom(b.searchRadius<21?r[b.searchRadius]:10)}function k(){l(t,u)}function l(a,d){e.getWishlistProducts(b,c,a,d,b.searchRadius,1,b.itemsPerPage).then(function(a){b.products=a,b.products.data.length>0&&(b.products.totalCount=b.products.data[0].TotalCount,b.productDataLength=b.products.data.length),b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength;var c=navigator.onLine;c&&o(t,u)})}function m(a,d){b.searchRadius;e.getWishlistProducts(b,c,a,d,b.searchRadius,1,b.itemsPerPage).then(function(a){b.products=a,b.products.data.length>0?(b.products.totalCount=b.products.data[0].TotalCount,b.productDataLength=b.products.data.length,b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength):b.products.totalCount=0,b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength})}function n(a,d){f.getStoreLocationsForWishlist(b,c,a,d,b.searchRadius).then(function(a){b.storeLocations=a,b.storeLocations.data.length>0?q():p()})}function o(a,c){var d={center:new google.maps.LatLng(a,c),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,panControl:!1,streetViewControl:!1,zoomControl:!0,scrollwheel:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}},e={url:"Content/images/VBuy_map32.png",size:new google.maps.Size(32,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(18,56)};b.map=new google.maps.Map(document.getElementById("map_canvassmall"),d);var f=new google.maps.Marker({position:new google.maps.LatLng(a,c),map:b.map,draggable:!0,icon:e,title:"Selected Area!.\n Drag to change center"});b.circle=new google.maps.Circle({center:new google.maps.LatLng(a,c),radius:1e3*b.searchRadius,strokeColor:"#138808",fillColor:"#FF9933",fillOpacity:.1,strokeOpacity:.8,strokeWeight:2,map:b.map}),n(a,c),google.maps.event.addListener(f,"drag",function(a){var c=a.latLng.lat(),d=a.latLng.lng();b.circle.setCenter(new google.maps.LatLng(c,d))}),google.maps.event.addListener(f,"dragend",function(a){var c=a.latLng.lat(),d=a.latLng.lng();p(),b.map.setCenter(new google.maps.LatLng(c,d)),b.circle.setCenter(new google.maps.LatLng(c,d)),n(c,d),m(c,d),s.title=c,s.value=d}),google.maps.event.clearListeners(window,"resize"),j()}function p(){for(var a=0;a<b.markers.length;a++)b.markers[a].setMap(null)}function q(){var a=new google.maps.InfoWindow({content:"loading"});p();for(var c=0;c<b.storeLocations.data.length;c++){var d=b.storeLocations.data[c].StoreName,e=d;d.length>8&&(e=d.substring(0,7)+"..");var f=new StyledIcon(StyledIconTypes.MARKER,{color:"#FF9933",fore:"#000080",text:e});5>c&&(f=new StyledIcon(StyledIconTypes.BUBBLE,{color:"#FF9933",fore:"#000080",text:e}));var g=new StyledMarker({map:b.map,styleIcon:f,animation:google.maps.Animation.DROP,labelClass:"maplabels",labelStyle:{opacity:.75},labelContent:b.storeLocations.data[c].StoreName,title:b.storeLocations.data[c].StoreName,position:new google.maps.LatLng(b.storeLocations.data[c].Latitude,b.storeLocations.data[c].Longitude),html:"<p><strong>"+b.storeLocations.data[c].BranchName+"</strong><br/>"+b.storeLocations.data[c].Address1+" , "+b.storeLocations.data[c].Address2+"</p>"});b.markers.push(g),google.maps.event.addListener(g,"click",function(){a.setContent(this.html),a.open(b.map,this)})}}b.markers=[],b.searchRadius=b.$parent.defaultRadius,b.priceRangeFrom=0,b.priceRangeTo=1e5,b.priceRange=[b.priceRangeFrom,b.priceRangeTo],b.itemsPerPage=50,b.showLoadMore=!1,b.productDataLength=0,b.searchFilter={},b.searchFilter.data={},b.searchFilter.data.Min=0,b.searchFilter.data.Max=1e5,b.loadPriceRangeSlider=!1;var r={1:14,2:14,3:14,4:13,5:13,6:12,7:12,8:12,9:12,10:12,11:11,12:11,13:11,14:11,15:11,16:11,17:11,18:11,19:11,20:11},s=document.getElementById("curLocation");null!=d.lat&&null!=d.lng&&(s.title=d.lat,s.value=d.lng);var t=s.title,u=s.value;(null==t||""==t||"undefined"===t)&&(t=13.058312,u=80.21195),b.storeLocations=[],b.searchedCategoryName=d.friendlyUrl,b.onPricingFilterChanged=function(){var a=s.title,c=s.value;b.productDataLength=0,m(a,c),n(a,c)},b.onProductFilterChanged=function(){var a=s.title,c=s.value;b.productDataLength=0,b.$parent.defaultRadius=b.searchRadius,m(a,c),n(a,c),b.circle.radius=1e3*b.searchRadius,b.circle.map=b.map,b.circle.setCenter(new google.maps.LatLng(a,c)),j()},b.showMap=function(){$("#modal-container-map").on("shown.bs.modal",function(){var a=s.title,c=s.value;window.setTimeout(function(){google.maps.event.trigger(b.map,"resize"),b.map.setCenter(new google.maps.LatLng(a,c))},0)}),$("#modal-container-map").modal("show")},k(),b.removeProductWishlist=function(d){if(b.userName&&b.userName.length>0){var e=$("#img_"+d.ProductId);flyToElement($(e),$("#wishlistTopLink")),g.removeUserWishlist(b,c,b.userName,d.ProductId).then(function(c){b.wishlist=c,d.FlagWishlist=!1,a.wishlistCount=c.data.length;var e=s.title,f=s.value;m(e,f)})}else{h({title:"Login for adding Wishlist",content:"You must login or create an account to add wishlist",show:!0})}},b.addProductWishlist=function(d){if(b.userName&&b.userName.length>0){var e=$("#img_"+d.ProductId);flyToElement($(e),$("#wishlistTopLink")),g.addUserWishlist(b,c,b.userName,d.ProductId).then(function(c){b.wishlist=c.data,a.wishlistCount=c.data.length,d.FlagWishlist=!0})}},b.loadMore=function(){var a=s.title,d=s.value,f=b.searchRadius;e.getWishlistProducts(b,c,a,d,f,b.products.data.length+1,b.itemsPerPage).then(function(a){for(i=0;i<a.data.length;i++)b.products.data.push(a.data[i]);b.productDataLength=b.products.data.length,b.showLoadMore=b.products.totalCount>0&&b.products.totalCount>b.productDataLength})}}]);