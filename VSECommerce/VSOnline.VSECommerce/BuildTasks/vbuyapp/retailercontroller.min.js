/*! VBuyApp 29-04-2016 */
app_retailer.controller("ForgotPasswordController",["$scope","$http","$location","$rootScope","passwordService",function(a,b,c,d,e){a.message="",a.successfullySent=!1,a.SendForgetPassword=function(){e.forgotPassword(a,b,a.Email).then(function(b){0==b.data?(a.message="Sorry. Unable to identify user. Please verify provided email id",a.successfullySent=!1):(a.message="A link has been sent to your mail to reset the password",a.successfullySent=!0)})}}]),app_retailer.controller("LandingController",["$rootScope","$scope","$http","$cookieStore","$routeParams","$location","authService",function(a,b,c,d,e,f,g){b.LogOut=function(){g.logOut(),a.flagLoggedIn=!1,d.remove("userName"),d.remove("flagLoggedIn"),f.path("#/Login")}}]),app_retailer.controller("RegisteredRetailerController",["$scope","$http","$routeParams","$location","$timeout","retailerServiceNew",function(a,b,c,d,e,f){function g(){var c={BusinessName:a.user.BusinessName,FirstName:a.user.FirstName,LastName:a.user.LastName,Email:a.user.Email,Password:a.user.Password,ConfirmPassword:a.user.ConfirmPassword,Address1:a.user.Address1,Address2:a.user.Address2,Pincode:a.user.Pincode,City:a.user.City,State:a.user.State,Country:a.user.Country,PhoneNumber1:a.user.PhoneNumber1,Latitude:a.user.Latitude,Longitude:a.user.Longitude};f.RegisterRetailer(a,b,c).then(function(){a.savedSuccessfully=!0,a.message="User has been registered successfully, you will be redicted to login page in 2 seconds.",e(function(){d.path("/Login")},4e3)},function(b){var c=[];for(var d in b.data.ModelState)for(var e=0;e<b.data.ModelState[d].length;e++)c.push(b.data.ModelState[d][e]);a.message="Failed to register user due to:"+c.join(" ")})}function h(b){if("string"==typeof b)return a.message==b,!1;var c=b[0].geometry.location;c=c.toString(),c=c.replace("("," "),c=c.replace(")"," "),c=c.split(",");var d=c[0],e=c[1];return a.user.Latitude=d,a.user.Longitude=e,!0}a.savedSuccessfully=!1,a.message="",a.user={},a.user.Country=42,a.user.State="TamilNadu",a.RegisterRetailer=function(){var b;b=a.Address1+","+a.Address2,b=b+","+a.user.City,b=b+","+a.user.State,b=b+","+a.user.Pincode;var c=new google.maps.Geocoder;c.geocode({address:b},function(b,c){if(c==google.maps.GeocoderStatus.OK){var d=b;h(d)&&g()}else d="We couldn't find that location. Try again.",a.savedSuccessfully=!1,a.message=d})}}]),app_retailer.controller("UserSettingsController",["$scope","$http","$routeParams","$modal","retailerServiceNew",function(){}]),app_retailer.controller("ChangePasswordController",["$rootScope","$scope","$http","$routeParams","passwordService",function(a,b,c,d,e){b.message="",b.user={},b.user.userName=a.userName,b.ChangePassword=function(){b.message="",b.user.NewPassword===b.user.ConfirmPassword?e.changePassword(b,c,b.user.userName,b.user.CurrentPassword,b.user.NewPassword).then(function(a){1==a.data?(b.savedSuccessfully=!0,b.message="Password has been changed Successfully."):(b.savedSuccessfully=!1,b.message="Error in updating Password")},function(a){b.message=a.error_description}):(b.savedSuccessfully=!1,b.message="Password mismatch")}}]),app_retailer.controller("MyDetailsController",["$rootScope","$scope","$http","$routeParams","authService","storesService",function(a,b,c,d,e,f){function g(){f.getMyDetails(b,c,b.user.userName).then(function(a){b.user.Email=a.data.Email,b.user.PhoneNumber1=a.data.PhoneNumber1,b.user.FirstName=a.data.FirstName,b.user.LastName=a.data.LastName})}b.user={},b.user.userName=a.userName,g()}]),app_retailer.controller("MyStoreController",["$rootScope","$scope","$http","$routeParams","authService","storesService",function(a,b,c,d,e,f){function g(){a.RetailerInfo.Branches.length>0&&(a.filters.selectedBranchId>0&&a.filters.selectedBranchId||(a.filters.selectedBranchId=a.RetailerInfo.Branches[0].BranchId)),f.getStoreDetails(b,c,b.user.userName,a.filters.selectedBranchId).then(function(a){b.branch.BranchName=a.data.BranchName,b.branch.Email=a.data.Email,b.branch.Country=a.data.Country,b.branch.State=a.data.State,b.branch.City=a.data.City,b.branch.Address1=a.data.Address1,b.branch.Address2=a.data.Address2,b.branch.PostalCode=a.data.PostalCode,b.branch.PhoneNumber=a.data.PhoneNumber,b.branch.Latitude=a.data.Latitude,b.branch.Longitude=a.data.Longitude})}b.message="",b.savedSuccessfully=!1,b.user={},b.user.userName=a.userName,b.branch={},b.flagBranchEdit=!1,g(),b.UpdateBranchDetails=function(d){d.BranchId=a.filters.selectedBranchId,f.updateBranchDetails(b,c,b.user.userName,d).then(function(a){"Success"==a.data?(b.savedSuccessfully=!0,b.message=" Updated Successfully "+d.BranchName):b.savedSuccessfully=!1,g(),b.flagBranchEdit=!1}),g(),b.flagBranchEdit=!1},b.CancelEdit=function(){g(),b.flagBranchEdit=!1}}]),app_retailer.controller("NewBranchController",["$rootScope","$scope","$http","$routeParams","$location","$timeout","storesService",function(a,b,c,d,e,f,g){function h(){var d={BranchName:b.branch.BranchName,FirstName:b.branch.FirstName,LastName:b.branch.LastName,Email:b.branch.Email,Address1:b.branch.Address1,Address2:b.branch.Address2,Pincode:b.branch.Pincode,City:b.branch.City,State:b.branch.State,Country:b.branch.Country,PhoneNumber:b.branch.PhoneNumber,Latitude:b.branch.Latitude,Longitude:b.branch.Longitude};g.createNewBranch(b,c,a.userName,d).then(function(a){"Success"==a.data?(b.savedSuccessfully=!0,b.message="New Branch Created successfully. Add Product to the branch."):b.message="Failed to create new branch"},function(a){var c=[];for(var d in a.data.ModelState)for(var e=0;e<a.data.ModelState[d].length;e++)c.push(a.data.ModelState[d][e]);b.message="Failed to create new branch "+c.join(" ")})}function i(a){if("string"==typeof a)return b.message==a,!1;var c=a[0].geometry.location;c=c.toString(),c=c.replace("("," "),c=c.replace(")"," "),c=c.split(",");var d=c[0],e=c[1];return b.branch.Latitude=d,b.branch.Longitude=e,!0}b.savedSuccessfully=!1,b.message="",b.branch={},b.branch.Country=42,b.branch.State="TamilNadu",b.CreateNewBranch=function(){var a;a=b.Address1+","+b.Address2,a=a+","+b.branch.City,a=a+","+b.branch.State,a=a+","+b.branch.Pincode;var c=new google.maps.Geocoder;c.geocode({address:a},function(a,c){if(c==google.maps.GeocoderStatus.OK){var d=a;i(d)&&h()}else d="We couldn't find that location. Try again.",b.savedSuccessfully=!1,b.message=d})}}]),app_retailer.controller("EditProductController",["$rootScope","$scope","$http","$routeParams","$filter","ngTableParams","FileUploader","productService","storesService","authInterceptorService",function(a,b,c,d,e,f,g,h,i,j){function k(){b.productId=d.productId?parseInt(d.productId):0,i.getFilter(c).then(function(a){b.filterList=a.data}),l()}function l(){b.productId>0&&h.getProductById(b,c,b.productId).then(function(a){b.product=a.data,b.filters.selectedSubCategory=b.product.Category,a.data.CategoryDetails&&(b.filters.selectedCategory=a.data.CategoryDetails.ParentCategoryId)})}b.savedSuccessfully=!1,b.message="",b.product={},b.productId=0,b.filterList={},b.filters={},k(),b.UpdateProduct=function(a){h.updateProduct(b,c,a).then(function(c){"Success"===c.data?(b.savedSuccessfully=!0,b.message=a.Name+" Updated",l()):(b.savedSuccessfully=!1,b.message=" Error updating "+a.Name)},function(a){b.message=a.error_description})};var m=b.uploader=new g({url:"api/FileUpload/UploadFile?productId="+b.productId,withCredentials:!0});j.request(m);m.headers.Authorization;m.filters.push({name:"customFilter",fn:function(a){this.queue.length>=3&&alert("Only 3 pictures can be selected");var b=!1,c=!1,d="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return b=-1!=="|jpg|png|jpeg|gif|".indexOf(d),0==b&&alert("Unsupported image type"),c=this.queue.length<3,b&&c}}),m.onSuccessItem=function(a,b){"success"===b.toLowerCase()&&l(),"failure"===b.toLowerCase()&&(a.isSuccess=!1,a.isError=!0),a.isUploading=!1},m.onErrorItem=function(a){a.isUploading=!1}}]),app_retailer.controller("FeaturesEditProductController",["$rootScope","$scope","$http","$routeParams","$filter","ngTableParams","FileUploader","productService","storesService","authInterceptorService",function(a,b,c,d,e,f,g,h){function i(){b.productId=d.productId?parseInt(d.productId):0,j(),k()}function j(){b.productId>0&&(h.getProductById(b,c,b.productId).then(function(a){b.product=a.data}),h.getProductKeyFeatures(b,c,b.productId).then(function(a){b.featureRows=a.data,0==b.featureRows.length&&b.addfeatureRow()}),h.getProductFilterValues(b,c,b.productId).then(function(a){b.filterRows=a.data,0==b.filterRows.length&&b.addfilterRow()}),h.getProductSpecification(b,c,b.productId).then(function(a){b.specRows=a.data,0==b.specRows.length&&b.addspecRow()}))}function k(){b.productId>0&&h.getFiltersForProductCategory(b,c,b.productId).then(function(a){b.productFilters=a.data})}b.savedSuccessfully=!1,b.message="",b.filterRows=[{}],b.featureRows=[{}],b.specRows=[{}],b.addfilterRow=function(){b.filterRows.push({})},b.addfeatureRow=function(){b.featureRows.push({})},b.addspecRow=function(){b.specRows.push({})},i(),b.updateProductSpecifications=function(){h.updateProductSpecifications(b,c,b.productId,b.filterRows,b.featureRows,b.specRows).then(function(a){b.flagUpdated=a.data,1==b.flagUpdated&&j()})}}]),app_retailer.controller("BulkUploadProductController",["$rootScope","$scope","$http","$routeParams","$filter","ngTableParams","FileUploader","productService","storesService","authInterceptorService",function(a,b,c,d,e,f,g,h,i,j){function k(){b.productId=d.productId?parseInt(d.productId):0,i.getFilter(c).then(function(a){b.filterList=a.data})}b.filterList={},b.filters={},b.categoryName=" ",b.subCategoryName=" ",b.savedSuccessfully=!1,b.message="",k();var l=b.uploaderBulkProducts=new g({url:"api/FileUpload/UploadBulkProducts",withCredentials:!0});j.request(l);l.headers.Authorization;l.onSuccessItem=function(a,c){"failure"===c.toLowerCase()||"error"===c.toLowerCase()?(a.isSuccess=!1,a.isError=!0):(b.savedSuccessfully=!0,b.message=c),a.isUploading=!1},l.onErrorItem=function(a){a.isUploading=!1};var m=b.uploaderBulkProductImageZip=new g({url:"api/FileUpload/UploadBulkImagesInZip",withCredentials:!0});j.request(m);m.headers.Authorization;m.onSuccessItem=function(a,b){"success"===b.toLowerCase(),"failure"===b.toLowerCase()&&(a.isSuccess=!1,a.isError=!0),a.isUploading=!1},m.onErrorItem=function(a){a.isUploading=!1};var n=b.uploaderBulkProductImage=new g({url:"api/FileUpload/UploadImagesInBulk?category="+b.categoryName+"&subCategory="+b.subCategoryName,withCredentials:!0});j.request(n);n.headers.Authorization;b.changeProductCategory=function(){var a=b.parentCategory.Name.trim().replace(/\s+/g,"_"),c=a.replace(/\&+/g,"_"),c=c.replace(/\_+/g,"_");b.categoryName=c.trim()},b.changeProductSubCategory=function(){var a=b.subCategory.Name.trim().replace(/\s+/g,"_"),c=a.replace(/\&+/g,"_"),c=c.replace(/\,+/g,"_"),c=c.replace(/\_+/g,"_");b.subCategoryName=c},n.filters.push({name:"customFilter",fn:function(a){this.queue.length>=100&&alert("Only 100 pictures can be selected");var b=!1,c=!1,d="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return b=-1!=="|jpg|png|jpeg|gif|".indexOf(d),0==b&&alert("Unsupported image type"),c=this.queue.length<=100,b&&c}}),n.onSuccessItem=function(a,b){"success"===b.toLowerCase(),"failure"===b.toLowerCase()&&(a.isSuccess=!1,a.isError=!0),a.isUploading=!1},n.onErrorItem=function(a){a.isUploading=!1},n.onBeforeUploadItem=function(a){-1==a.file.name.indexOf("/")&&(a.file.name=b.categoryName+"/"+b.subCategoryName+"/"+a.file.name)}}]),app_retailer.controller("SEOEditProductController",["$rootScope","$scope","$http","$routeParams","productService","storesService","authInterceptorService",function(a,b,c,d,e){function f(){b.productId=d.productId?parseInt(d.productId):0,g()}function g(){b.productId>0&&e.getProductById(b,c,b.productId).then(function(a){b.product=a.data})}b.savedSuccessfully=!1,b.message="",f(),b.UpdateProductSeo=function(a){e.updateProductSeo(b,c,a).then(function(c){"Success"===c.data?(b.savedSuccessfully=!0,b.message=a.Name+" - SEO Updated",g()):(b.savedSuccessfully=!1,b.message=" Error updating SEO for "+a.Name)},function(a){b.message=a.error_description})}}]),app_retailer.controller("LoginController",["$scope","$cookieStore","$location","$rootScope","authService",function(a,b,c,d,e){function f(){b.remove("userName"),b.remove("flagLoggedIn"),b.remove("curUserDisplayName")}a.loginData={userName:"",password:""},a.message="",a.Login=function(){e.login(a.loginData).then(function(){d.flagLoggedIn=!0,d.userName=a.loginData.userName,b.put("userName",d.userName),b.put("flagLoggedIn",d.flagLoggedIn),d.curUserDisplayName=a.loginData.userName,b.put("curUserDisplayName",d.curUserDisplayName),c.path("/Dashboard")},function(b){a.message=b.error_description,d.flagLoggedIn=!1,f()})},a.ChangePassword=function(){a.message="",a.user={},a.user.userName=d.userName,a.user.NewPassword===a.user.ConfirmPassword?passwordService.changePassword(a,$http,a.user.userName,a.user.CurrentPassword,a.user.NewPassword).then(function(b){1==b.data?(a.savedSuccessfully=!0,a.message="Password has been changed Successfully."):(a.savedSuccessfully=!1,a.message="Error in updating Password")},function(b){a.message=b.error_description}):(a.savedSuccessfully=!1,a.message="Password mismatch")}}]),app_retailer.controller("ordersController",["$rootScope","$scope","$http","$route","$routeParams","$filter","ordersService","storesService","ngTableParams","authInterceptorService",function(a,b,c,d,e,f,g,h,i){function j(){h.getRetailerInfo(c).then(function(c){a.flagLoggedIn=!0,b.RetailerInfo=c.data,a.RetailerInfo=c.data,a.StoreName=b.RetailerInfo.StoreName},function(c){b.message=c.error_description,a.flagLoggedIn=!1}),h.getFilter(c).then(function(a){b.filterList=a.data,m()},function(a){b.message=a.error_description})}b.RetailerInfo={},b.filters={},b.message="",b.pendingOrdersList={},b.filteredOrdersList={},b.OrderStatusList={},b.PaymentOptionList={},b.pageButtonList=[],b.currentPage=0;var k=1e5,l=1;b.pagenumbers=0;var m=function(){a.RetailerInfo.Branches.length>0&&(a.filters.selectedBranchId>0&&a.filters.selectedBranchId||(a.filters.selectedBranchId=a.RetailerInfo.Branches[0].BranchId)),b.filterList.CategoryFilter.length>0&&(b.filters.selectedCategory=b.filterList.CategoryFilter[0].CategoryId);var c=a.filters.selectedBranchId;p(),q(),o(c),n(c,k,l)},n=function(a,d,e){g.getPendingOrders(b,c,a,d,e).then(function(a){b.pendingOrdersList=a.data,b.pendingOrdersGridParams.reload()},function(){})},o=function(a){g.GetTotalOrders(b,c,a).then(function(a){b.TotalOrdersList=a.data},function(){})};b.pendingOrdersTabClick=function(){var c=a.filters.selectedBranchId;b.pageButtonList=[],n(c,k,l)};var p=function(){g.getOrderStatus(b,c).then(function(a){b.OrderStatusList=a.data},function(){})};b.GetOrdersPage=function(b){var c=b.target.attributes.data.value,d=a.filters.selectedBranchId;n(d,k,c)};var q=function(){g.GetPaymentOption(b,c).then(function(a){b.PaymentOptionList=a.data},function(){})};j(),b.changeOrderStatus=function(a){var d=window.confirm("Proceed with changing Order Status? \n SubOrder Number : "+a.Id+"\n Order Number : "+a.OrderId);d&&g.UpdateOrderStatus(b,c,a.Id,a.OrderId,a.OrderItemStatusId).then(function(c){"true"==c.data&&b.pendingOrdersTabClick(),b.pendingOrdersGridParams.reload(),b.message=a.Id+" / "+a.OrderId+" Status Changed.",b.savedSuccessfully=!0})},b.changePaymentStatus=function(a){b.orderPaymentStatusId=a.OrderItemStatusId,g.UpdatePaymentStatus(b,c)},b.SearchOrders=function(d){var e=a.filters.selectedBranchId;if(!(d.status&&""!=d.status||d.id>0))return void n(e,k,l);var f=d.status,h=d.payment,i=d.id;null==i&&(i=0),null==f&&(f=0),null==d.payment&&(h=0),g.getOrderSearch(b,c,e,f,i,h).then(function(a){b.pendingOrdersList=a.data,b.pendingOrdersGridParams.reload()},function(){})};var r=function(){var a,c=4;if(a=b.currentPage,b.pagenumbers<4){b.pageButtonList=[];for(var d=a;d<=b.pagenumbers;d++)b.pageButtonList.push(d)}else{a>b.pagenumbers-c&&(a=b.pagenumbers-c+1),b.pageButtonList=[];for(var d=a;a+c>d;d++)b.pageButtonList.push(d)}};b.prevPage=function(){if(b.currentPage>0){var c=b.currentPage-1,d=a.filters.selectedBranchId;n(d,k,c),b.currentPage--,r()}},b.DisablePrevPage=function(){return 0===b.currentPage?"disabled":""};b.nextPage=function(){if(b.currentPage<b.pagenumbers){var c=b.currentPage+1,d=a.filters.selectedBranchId;n(d,k,c),b.currentPage++,r()}},b.DisableNextPage=function(){return b.currentPage===b.pagenumbers?"disabled":""},b.setPage=function(c){var d=c+1,e=a.filters.selectedBranchId;n(e,k,d),b.currentPage=c},b.pendingOrdersGridParams=new i({page:1,count:10},{counts:[10,25,50,100],total:angular.isUndefined(b.pendingOrdersList.length)?0:b.pendingOrdersList.length,getData:function(a,c){b.filteredOrdersList=c.sorting()?f("orderBy")(b.pendingOrdersList,c.orderBy()):b.pendingOrdersList,b.filteredOrdersList=c.filter()?f("filter")(b.filteredOrdersList,c.filter()):b.filteredOrdersList,b.filteredOrdersList&&b.filteredOrdersList.length>0?(c.total(b.filteredOrdersList.length),c.totalPage=Math.ceil(b.filteredOrdersList.length/c.count()),b.filteredOrdersList=b.filteredOrdersList.slice((c.page()-1)*c.count(),c.page()*c.count()),a.resolve(b.filteredOrdersList)):(c.total(b.pendingOrdersList.length),c.totalPage=Math.ceil(b.pendingOrdersList.length/c.count()),a.resolve(b.pendingOrdersList))}}),a.onBranchChange=function(){d.reload()},b.getLocalDate=function(a){var b=new Date(a+"Z");return b}}]),app_retailer.controller("PrintOrderController",["$scope","$location","$http","$rootScope","$routeParams","ordersService",function(a,b,c,d,e,f){function g(){f.printOrderDetails(c,e.orderId).then(function(b){if(b.data){a.printorderDetails=b.data;var c=new Date(a.printorderDetails.OrderDetails.OrderDateUtc+"Z");a.orderConfirmationDate=c}})}a.message="",a.orderConfirmationDate={},g()}]),app_retailer.controller("dashboardController",["$rootScope","$scope","$http","$route","$routeParams","$filter","ordersService","storesService","authInterceptorService",function(a,b,c,d,e,f,g,h){function i(a,b,c){var d=[],e={};return a.forEach(function(a){e[a[b]]||(e[a[b]]={},e[a[b]][b]=a[b],e[a[b]][c]=0,d.push(e[a[b]])),e[a[b]][c]+=+a[c]}),d}function j(){h.getRetailerInfo(c).then(function(c){a.flagLoggedIn=!0,b.RetailerInfo=c.data,a.RetailerInfo=c.data,a.StoreName=b.RetailerInfo.StoreName},function(c){b.message=c.error_description,a.flagLoggedIn=!1}),h.getFilter(c).then(function(a){b.filterList=a.data,k()},function(a){b.message=a.error_description}),l()}b.RetailerInfo={},b.filters={},b.message="",b.orderSummaryList={},b.OrderStatusList={},b.PaymentOptionList={},b.TotalOrdersList={};var k=function(){a.RetailerInfo.Branches.length>0&&(a.filters.selectedBranchId>0&&a.filters.selectedBranchId||(a.filters.selectedBranchId=a.RetailerInfo.Branches[0].BranchId)),b.filterList.CategoryFilter.length>0&&(b.filters.selectedCategory=b.filterList.CategoryFilter[0].CategoryId);var c=a.filters.selectedBranchId;l(c)},l=function(a){g.getOrdersSummary(b,c,a).then(function(a){b.orderSummaryList=a.data},function(){}),g.getOrderSummaryByCategory(b,c,a).then(function(a){b.orderCategorySummaryList=a.data},function(){}),g.getOrderSummaryByProduct(b,c,a).then(function(a){b.orderProductSummaryList=a.data},function(){}),g.getOrderCountByStatus(b,c,a).then(function(a){var c=[],d=[];b.orderCountByStatusSummaryList=a.data;for(var e=i(b.orderCountByStatusSummaryList,"PaymentMethodString","OrderCount"),f=0;f<e.length;f++)c.push(e[f].PaymentMethodString),d.push(e[f].OrderCount);b.labelpaymentMethod=c,b.datapaymentMethod=d},function(){}),g.getBranchProductSummary(b,c,a).then(function(a){b.branchProductSummaryList=a.data},function(){}),g.getBranchEnquirySummary(b,c,a).then(function(a){b.branchEnquirySummaryList=a.data},function(){}),g.getLast7DaysSalesChart(b,c,a).then(function(a){b.branch7daysSalesChart=a.data,b.labelweekday=[],b.seriesweekday=[],b.dataweekday=[],b.seriesweekday=["Sales"];for(var c=[],d=[],e=0;e<b.branch7daysSalesChart.length;e++)c.push(b.branch7daysSalesChart[e].Period),d.push(b.branch7daysSalesChart[e].Total);b.labelweekday=c,b.dataweekday.push(d)},function(){}),g.getLast6MonthsSalesChart(b,c,a).then(function(a){b.branch6MonthsSalesChart=a.data,b.labelMonth=[],b.seriesMonth=[],b.dataMonth=[],b.seriesMonth=["Sales"];for(var c=[],d=[],e=0;e<b.branch6MonthsSalesChart.length;e++)c.push(b.branch6MonthsSalesChart[e].Period),d.push(b.branch6MonthsSalesChart[e].Total);b.labelMonth=c,b.dataMonth.push(d)},function(){})};j(),a.onBranchChange=function(){d.reload()}}]),app_retailer.controller("ResetPasswordController",["$scope","$location","$http","$rootScope","$routeParams","passwordService",function(a,b,c,d,e,f){function g(){a.uid=e.uid,a.username=e.username}a.message="",g(),a.ResetPassword=function(){a.message="",a.user.Password===a.user.ConfirmPassword?f.resetPassword(a,c,a.username,a.user.Password).then(function(b){1==b.data?(a.savedSuccessfully=!0,a.message="Password has been changed Successfully."):(a.savedSuccessfully=!1,a.message="Error in updating Password")},function(b){a.message=b.error_description}):(a.savedSuccessfully=!1,a.message="Password mismatch")}}]),app_retailer.controller("StoresController",["$rootScope","$scope","$http","$routeParams","$route","$filter","ngTableParams","FileUploader","storesService","authInterceptorService",function(a,b,c,d,e,f,g,h,i){function j(){i.getRetailerInfo(c).then(function(c){a.flagLoggedIn=!0,b.RetailerInfo=c.data,a.RetailerInfo=c.data,a.StoreName=b.RetailerInfo.StoreName},function(c){b.message=c.error_description,a.flagLoggedIn=!1}),i.getFilter(c).then(function(a){b.filterList=a.data,k()},function(a){b.message=a.error_description})}b.StoreName="",b.message="",b.filters={},b.ProductList={},b.filteredProductList={},b.MyFilteredProductList={},b.RetailerInfo={},j();var k=function(){if(b.RetailerInfo=a.RetailerInfo,b.RetailerInfo.Branches.length>0&&(a.filters.selectedBranchId>0||(a.filters.selectedBranchId=b.RetailerInfo.Branches[0].BranchId,b.filters.selectedBranchId=a.filters.selectedBranchId)),b.filterList.CategoryFilter.length>0&&(b.filters.selectedCategory=b.filterList.CategoryFilter[0].CategoryId,b.filters.selectedCategoryObj=b.filterList.CategoryFilter[0],!(b.filters.selectedSubCategory>0))){var c=f("filter")(b.filterList.SubCategoryFilter,{ParentCategoryId:b.filters.selectedCategory});b.filters.selectedSubCategoryObj=c[0],b.filters.selectedSubCategory=c[0].CategoryId}b.selectedPage=1,l()};b.GetProducts=function(){l()},a.onBranchChange=function(){e.reload()};var l=function(){i.getProducts(b,c).then(function(a){b.ProductList=a.data,b.includeProductsGridParams.reload()},function(a){b.message=a.error_description})};b.includeProductsGridParams=new g({page:1,count:10,filter:{Name:""}},{counts:[10,25,50,100],paginationMaxBlocks:12,paginationMinBlocks:2,total:angular.isUndefined(b.ProductList.length)?0:b.ProductList.length,getData:function(a,c){b.filteredProductList=c.sorting()?f("orderBy")(b.ProductList,c.orderBy()):b.ProductList,b.filteredProductList=c.filter()?f("filter")(b.filteredProductList,c.filter()):b.filteredProductList,c.total(b.filteredProductList.length),c.totalPage=Math.ceil(b.filteredProductList.length/c.count()),b.filteredProductList.length>0&&(b.filteredProductList=b.filteredProductList.slice((c.page()-1)*c.count(),c.page()*c.count())),a.resolve(b.filteredProductList)}}),b.savedSuccessfully=!1,b.IncludeProduct=function(d){d.StoreId=b.RetailerInfo.StoreId,d.BranchIdList=a.filters.selectedBranchId,d.NewPrice||(d.NewPrice=d.Price),d.NewSpecialPrice||(d.NewSpecialPrice=d.NewPrice),i.includeProduct(b,c,d).then(function(a){var c=a.data;"success"===c.toLowerCase()?(b.savedSuccessfully=!0,b.message=d.Name+"  Added to your Store"):"alreadyexist"===c.toLowerCase()?(b.savedSuccessfully=!1,b.message=d.Name+" Already exist in your store"):(b.savedSuccessfully=!1,b.message=" Error updating "+d.Name)},function(a){b.savedSuccessfully=!1,b.message=a.error_description}),d.$edit=!1},b.changeCategory=function(){b.filters.selectedCategory=b.filters.selectedCategoryObj.CategoryId,b.filters.selectedCategoryName=b.filters.selectedCategoryObj.Name},b.changeSubCategory=function(){b.filters.selectedSubCategory=b.filters.selectedSubCategoryObj.CategoryId,b.filters.selectedSubCategoryName=b.filters.selectedSubCategoryObj.Name};var m=function(){var a,c=4;if(a=b.currentPage,b.pagenumbers<4){b.pageButtonList=[];for(var d=a;d<=b.pagenumbers;d++)b.pageButtonList.push(d)}else{a>b.pagenumbers-c&&(a=b.pagenumbers-c+1),b.pageButtonList=[];for(var d=a;a+c>d;d++)b.pageButtonList.push(d)}};b.prevPage=function(){if(b.currentPage>0){var a=b.currentPage-1;productPageList(a),b.currentPage--,m()}},b.DisablePrevPage=function(){return 0===b.currentPage?"disabled":""};b.nextPage=function(){if(b.currentPage<b.pagenumbers){var a=b.currentPage+1;productPageList(a),b.currentPage++,m()}},b.DisableNextPage=function(){return b.currentPage===b.pagenumbers?"disabled":""},b.setPage=function(a){var c=a+1;productPageList(c),b.currentPage=a}}]),app_retailer.controller("InboxController",["$rootScope","$scope","$http","$routeParams","$route","$filter","ngTableParams","storesService","authInterceptorService",function(a,b,c,d,e,f,g,h){function i(){h.getRetailerInfo(c).then(function(c){a.flagLoggedIn=!0,b.RetailerInfo=c.data,a.RetailerInfo=c.data,a.StoreName=b.RetailerInfo.StoreName},function(c){b.message=c.error_description,a.flagLoggedIn=!1}),h.getFilter(c).then(function(a){b.filterList=a.data,k(),j()},function(a){b.message=a.error_description})}function j(){h.getInbox(b,c,a.filters.selectedBranchId).then(function(a){b.MyInboxList=a.data,b.myInbox.reload()})}b.StoreName="",b.message="",b.MyInboxList={},i();var k=function(){a.RetailerInfo.Branches.length>0&&(a.filters.selectedBranchId>0&&a.filters.selectedBranchId||(a.filters.selectedBranchId=a.RetailerInfo.Branches[0].BranchId))};b.myInbox=new g({page:1,count:40},{counts:[10,25,50,100],total:angular.isUndefined(b.MyInboxList.length)?0:b.MyInboxList.length,getData:function(a,c){b.gridInboxList=c.sorting()?f("orderBy")(b.MyInboxList,c.orderBy()):b.MyInboxList,b.gridInboxList=c.filter()?f("filter")(b.gridInboxList,c.filter()):b.gridInboxList,c.total(b.gridInboxList.length),c.totalPage=Math.ceil(b.gridInboxList.length/c.count()),b.gridInboxList.length>0&&(b.gridInboxList=b.gridInboxList.slice((c.page()-1)*c.count(),c.page()*c.count())),a.resolve(b.gridInboxList)}}),b.savedSuccessfully=!1,b.InboxReply=function(a,d,e){var f=!1;h.InboxReply(b,c,a,d).then(function(a){"OK"==a.statusText?(e.replyStatusError="",e.replyStatus="successfully replied",f=!0):(e.replyStatus="",e.replyStatusError="Reply not sent. please resend",f=!0)})},a.onBranchChange=function(){e.reload()}}]),app_retailer.controller("PricingController",["$rootScope","$scope","$http","$routeParams","$route","$filter","ngTableParams","storesService","authInterceptorService",function(a,b,c,d,e,f,g,h){function i(){h.getRetailerInfo(c).then(function(c){a.flagLoggedIn=!0,b.RetailerInfo=c.data,a.RetailerInfo=c.data,a.StoreName=b.RetailerInfo.StoreName},function(c){b.message=c.error_description,a.flagLoggedIn=!1}),h.getFilter(c).then(function(a){b.filterList=a.data,k()},function(a){b.message=a.error_description})}b.StoreName="",b.message="",b.filters={},b.MyFilteredProductList={},b.gridfilteredPricingList={},b.RetailerInfo={},b.pageButtonList=[],b.pricingPageButtonList=[];var j=1e5;b.pagenumbers=0,a.onBranchChange=function(){e.reload()};var k=function(){if(b.RetailerInfo=a.RetailerInfo,b.RetailerInfo.Branches.length>0&&(a.filters.selectedBranchId>0||(a.filters.selectedBranchId=b.RetailerInfo.Branches[0].BranchId),b.filters.selectedBranchId=a.filters.selectedBranchId),b.filterList.CategoryFilter.length>0&&(b.filters.selectedCategory=b.filterList.CategoryFilter[0].CategoryId,b.filters.selectedCategoryObj=b.filterList.CategoryFilter[0],!(b.filters.selectedSubCategory>0))){var c=f("filter")(b.filterList.SubCategoryFilter,{ParentCategoryId:b.filters.selectedCategory});b.filters.selectedSubCategoryObj=c[0],b.filters.selectedSubCategory=c[0].CategoryId}b.selectedPage=1,l()};i();var l=function(){var a=b.selectedPage;h.getMyFilteredProductsPaging(b,c,a,j).then(function(a){if(b.MyFilteredProductList=a.data,null!=b.MyFilteredProductList)for(var c=0;c<b.MyFilteredProductList.length;c++)b.MyFilteredProductList[c].NewPrice=b.MyFilteredProductList[c].Price,b.MyFilteredProductList[c].NewSpecialPrice=b.MyFilteredProductList[c].SpecialPrice,b.MyFilteredProductList[c].NewSpecialPriceDescription=b.MyFilteredProductList[c].SpecialPriceDescription,b.MyFilteredProductList[c].NewPriceStartTime=b.MyFilteredProductList[c].PriceStartTime,b.MyFilteredProductList[c].NewPriceEndTime=b.MyFilteredProductList[c].PriceEndTime,b.MyFilteredProductList[c].NewAdditionalTax=b.MyFilteredProductList[c].AdditionalTax,b.MyFilteredProductList[c].NewShippingCharge=b.MyFilteredProductList[c].AdditionalShippingCharge,b.MyFilteredProductList[c].NewDeliveryTime=b.MyFilteredProductList[c].DeliveryTime;b.myProductGridParams.reload()})};b.GetProducts=function(){l()},b.myProductGridParams=new g({count:10,filter:{ProductName:""}},{counts:[10,25,50,100],paginationMaxBlocks:12,paginationMinBlocks:2,total:angular.isUndefined(b.MyFilteredProductList.length)?0:b.MyFilteredProductList.length,getData:function(a,c){b.MyFilteredProductList.length>0?(b.gridfilteredPricingList=c.sorting()?f("orderBy")(b.MyFilteredProductList,c.orderBy()):b.MyFilteredProductList,b.gridfilteredPricingList=c.filter()?f("filter")(b.gridfilteredPricingList,c.filter()):b.gridfilteredPricingList,c.total(b.gridfilteredPricingList.length),c.totalPage=Math.ceil(b.gridfilteredPricingList.length/c.count()),b.gridfilteredPricingList.length>0&&(b.gridfilteredPricingList=b.gridfilteredPricingList.slice((c.page()-1)*c.count(),c.page()*c.count())),a.resolve(b.gridfilteredPricingList)):a.resolve(b.MyFilteredProductList)}}),b.savedSuccessfully=!1,b.UpdatePrice=function(a){h.updatePrice(b,c,a).then(function(c){c.data===!0?(b.savedSuccessfully=!0,b.message=a.ProductName+" Updated",b.GetProducts()):(b.savedSuccessfully=!1,b.message=" Error updating "+a.ProductName)},function(a){b.message=a.error_description}),a.$edit=!1},b.changeCategory=function(){b.filters.selectedCategory=b.filters.selectedCategoryObj.CategoryId,b.filters.selectedCategoryName=b.filters.selectedCategoryObj.Name},b.changeSubCategory=function(){b.filters.selectedSubCategory=b.filters.selectedSubCategoryObj.CategoryId,b.filters.selectedSubCategoryName=b.filters.selectedSubCategoryObj.Name},b.Suspend=function(a){h.removeProduct(b,c,a).then(function(c){1==c.data?(b.savedSuccessfully=!0,b.message=a.ProductName+" Removed",b.GetProducts()):(b.savedSuccessfully=!1,b.message="Cannot Remove "+a.ProductName)},function(a){b.message=a.error_description})},b.Resume=function(a){h.resumeProduct(b,c,a).then(function(c){1==c.data?(b.savedSuccessfully=!0,b.message=a.ProductName+" Resumed Successfully",b.GetProducts()):(b.savedSuccessfully=!1,b.message="Cannot Include "+a.ProductName)},function(a){b.message=a.error_description})};b.prevPricingPage=function(){if(b.currentPricingPage>0){var a=b.currentPricingPage-1;l(a),b.currentPricingPage--}},b.DisablePrevPricingPage=function(){return 0===b.currentPricingPage?"disabled":""};b.nextPricingPage=function(){if(b.currentPricingPage<b.pricingPagenumber){var a=b.currentPricingPage+1;l(a),b.currentPricingPage++}},b.DisableNextPricingPage=function(){return b.currentPricingPage===b.pricingPagenumber?"disabled":""},b.setPricingPage=function(a){var c=a+1;l(c),b.currentPricingPage=a}}]),app_retailer.controller("NewProductController",["$rootScope","$scope","$http","$routeParams","$filter","$timeout","$location","ngTableParams","FileUploader","storesService","authInterceptorService",function(a,b,c,d,e,f,g,h,i,j){function k(){j.getRetailerInfo(c).then(function(c){a.flagLoggedIn=!0,b.RetailerInfo=c.data,a.RetailerInfo=c.data,a.StoreName=b.RetailerInfo.StoreName,branch=b.RetailerInfo.Branches[0].BranchId},function(c){b.message=c.error_description,a.flagLoggedIn=!1}),j.getFilter(c).then(function(a){b.filterList=a.data,l()},function(a){b.message=a.error_description
})}b.StoreName="",b.message="",b.filters={},b.newproduct={},b.RetailerInfo={},b.weightList=[{name:"g",Id:1},{name:"mg",Id:2},{name:"kg",Id:3}],b.LWHList=[{name:"cm",Id:1},{name:"mm",Id:2},{name:"inch",Id:3}],k(),b.showProduct=!1,b.showPricing=!1;var l=function(){b.RetailerInfo.Branches.length>0&&(a.filters.selectedBranchId>0||(a.filters.selectedBranchId=b.RetailerInfo.Branches[0].BranchId)),b.filterList.CategoryFilter.length>0&&(b.filters.selectedCategory=b.filterList.CategoryFilter[0].CategoryId)};b.savedSuccessfully=!1,b.changeProductCategory=function(){b.newproduct.selectedCategory=b.newproduct.selectedCategoryObj.CategoryId,b.newproduct.selectedCategoryName=b.newproduct.selectedCategoryObj.Name},b.changeProductSubCategory=function(){b.newproduct.selectedSubCategory=b.newproduct.selectedSubCategoryObj.CategoryId,b.newproduct.selectedSubCategoryName=b.newproduct.selectedSubCategoryObj.Name},b.AddNewProduct=function(a){a.Category=b.newproduct.selectedSubCategory,a.Weight=a.WeightProperty+a.selectWeight?a.selectWeight.name:"",a.Length=a.LengthProperty+a.selectLWh?a.selectLWh.name:"",a.Width=a.WidthProperty+a.selectLWh?a.selectLWh.name:"",a.Height=a.HeightProperty+a.selectLWh?a.selectLWh.name:"";b.newproduct.selectedCategory,b.newproduct.selectedSubCategory;j.createProduct(b,c,a).then(function(c){c.data&&"Success"===c.data.StatusString?(b.savedSuccessfully=!0,b.message=a.Name+" created Go to Manage Product and add the product to your stores.",f(function(){g.path("/UpdateProductImage/"+c.data.NewProduct.ProductId)},4e3)):c.data&&"alreadyexist"===c.data.StatusString.toLowerCase()?(b.savedSuccessfully=!1,b.message=a.Name+" already availble in catalog"):(b.savedSuccessfully=!1,b.message=" Error updating "+a.Name)},function(a){b.message=a.error_description})}}]);