/*! VBuyApp 29-04-2016 */
app.factory("authInterceptorService",["$q","$injector","$location","localStorageService",function(a,b,c,d){var e={},f=function(a){a.headers=a.headers||{};var b=d.get("authorizationData");return b&&(a.headers.Authorization="Bearer "+b.token),a},g=function(e){if(401===e.status){var f=b.get("authService"),g=d.get("authorizationData");if(g&&g.useRefreshTokens)return c.path("/refresh"),a.reject(e);f.logOut()}return a.reject(e)};return e.request=f,e.responseError=g,e}]),app.factory("authService",["$rootScope","$http","$q","localStorageService",function(a,b,c,d){function e(a,e){var f=c.defer();return b.post("/VBuy/token",a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){d.set("authorizationData",{token:a.access_token,userName:e,refreshToken:"",useRefreshTokens:!1}),g.isAuth=!0,g.userName=e,f.resolve(a)}).error(function(a){k(),f.reject(a)}),f.promise}var f={},g={isAuth:!1,userName:"",useRefreshTokens:!1},h=function(a,b){var c="grant_type=social_login&tokenOrigin=facebook&access_token="+a;return e(c,b)},i=function(a,b,c,d,f,g){var h="grant_type=social_login&tokenOrigin=google&access_token="+a+"&expires_in="+c+"&expires_at="+d+"&token_type="+f+"&issued_at="+g;return e(h,b)},j=function(a){var b="grant_type=password&username="+a.userName+"&password="+a.password;return e(b,a.userName)},k=function(){d.remove("authorizationData"),g.isAuth=!1,g.userName="",g.useRefreshTokens=!1,d.remove("userName"),d.remove("flagLoggedIn"),d.remove("curUserDisplayName"),a.flagLoggedIn=!1,gapi&&gapi.auth&&gapi.auth.signOut()},l=function(){var a=d.get("authorizationData");a&&(g.isAuth=!0,g.userName=a.userName,g.useRefreshTokens=a.useRefreshTokens)},m=function(){var a=c.defer(),e=d.get("authorizationData");if(e&&e.useRefreshTokens){var f="grant_type=";d.remove("authorizationData"),b.post(serviceBase+"token",f,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b){d.set("authorizationData",{token:b.access_token,userName:b.userName,refreshToken:b.refresh_token,useRefreshTokens:!0}),a.resolve(b)}).error(function(b){_logOut(),a.reject(b)})}return a.promise},n=function(a){var e=c.defer();return b.get(serviceBase+"api/account/ObtainLocalAccessToken",{params:{provider:a.provider,externalAccessToken:a.externalAccessToken}}).success(function(a){d.set("authorizationData",{token:a.access_token,userName:a.userName,refreshToken:"",useRefreshTokens:!1}),g.isAuth=!0,g.userName=a.userName,g.useRefreshTokens=!1,e.resolve(a)}).error(function(a){_logOut(),e.reject(a)}),e.promise},o=function(a){var e=c.defer();return b.post(serviceBase+"api/account/registerexternal",a).success(function(a){d.set("authorizationData",{token:a.access_token,userName:a.userName,refreshToken:"",useRefreshTokens:!1}),g.isAuth=!0,g.userName=a.userName,g.useRefreshTokens=!1,e.resolve(a)}).error(function(a){_logOut(),e.reject(a)}),e.promise};return f.login=j,f.loginWithFacebook=h,f.loginWithGoogle=i,f.logOut=k,f.fillAuthData=l,f.authentication=g,f.refreshToken=m,f.obtainAccessToken=n,f.externalAuthData=l,f.registerExternal=o,f}]),app.service("cartService",function(){var a="/VBuy/api/Cart",b="/VBuy/api/CheckOut";this.getOrderConfirmationDetails=function(a,c,d){var e={params:{orderId:c,userName:d}};return a.get(b+"/GetOrderConfirmationDetails/",e)},this.generateOrder=function(a,c,d,e,f,g){var h={shoppingCartDTOList:c,userName:d,paymentMethod:e,deliveryMethod:f,couponCode:g};return a.post(b+"/CreateOrderForCart/",h)},this.initiatePaymentForOrder=function(a,c,d){var e={params:{orderId:d,userName:c}};return a.get(b+"/InitiatePaymentGateway/",e)},this.addShoppingCartItem=function(b,c,d){var e={ProductId:c.ProductId,BranchId:c.BranchId,UnitPrice:c.SpecialPrice,Quantity:c.Quantity,AdditionalShippingCharge:c.AdditionalShippingCharge,UserName:d,SelectedSize:c.SelectedSize};return b.post(a+"/AddShoppingCartItem/",e)},this.addShoppingCartItemList=function(b,c,d){var e={shoppingCartDTOList:c,userName:d};return b.post(a+"/AddShoppingCartItemList/",e)},this.updateCartItemQuantity=function(b,c,d){var e={ProductId:c.ProductId,BranchId:c.BranchId,UnitPrice:c.SpecialPrice,Quantity:c.Quantity,AdditionalShippingCharge:c.AdditionalShippingCharge,UserName:d};return b.post(a+"/UpdateCartItemQuantity/",e)},this.getCartDiscount=function(a,c,d,e){var f={params:{userName:d,couponCode:e}};return a.get(b+"/GetCartDiscount/",f)},this.removeShoppingCartItem=function(b,c,d){var e={ProductId:c.ProductId,BranchId:c.BranchId,UnitPrice:c.SpecialPrice,Quantity:c.Quantity,AdditionalShippingCharge:c.AdditionalShippingCharge,UserName:d};return b.post(a+"/RemoveShoppingCartItem/",e)},this.getShoppingCartItems=function(b,c){var d={params:{userName:c}};return b.get(a+"/GetShoppingCartItems/",d)},this.getBuyerAddress=function(b,c){var d={params:{userName:c}};return b.get(a+"/GetBuyerAddress/",d)},this.addBuyerAddress=function(b,c,d){return c.UserName=d,b.post(a+"/AddBuyerAddress/",c)}}),app.service("categoryService",function(){var a="/VBuy/api/Admin";this.getAllCategory=function(b,c){var d={headers:{CommandType:"GetAllCategory"}};return b.app={},c.get(a,d).success(function(a){b.app.category=a}).error(function(){b.app.error="something's broken"}),b.app.category}}),app.service("landingService",function(){var a="/VBuy/api/Landing",b=document.getElementById("curLocation");this.getAppData=function(b){var c={headers:{CommandType:"GetApplicationData"}};return b.get(a+"/GetApplicationData",c)},this.getMainMenu=function(b,c){var d={headers:{CommandType:"GetMainMenu"}};return c.get(a+"/GetMainMenu",d)},this.getSearchProductList=function(b,c,d,e){var f=d.defer(),g=function(a){f.resolve(a)},h=c.get(a+"/GetSearchProductsFilter",{timeout:f.promise,headers:{CommandType:"GetSearchProductsFilter"},params:{searchString:e}}).then(function(a){return a.data});return{promise:h,cancel:g}},this.getFeaturedProducts=function(b,c){var d={headers:{CommandType:"GetFeaturedProducts"}};return c.get(a+"/GetFeaturedProducts",d)},this.getTopSellingProductList1=function(b,c){return c.get(a+"/GetTopSellingProductList1")},this.getHomeBannerSettings=function(b,c){return c.get(a+"/GetHomeBannerSettings")},this.topSellingProductList2=function(b,c){return c.get(a+"/GetPersonalizedProductList1")},this.getTopCategoriesList=function(b,c){return c.get(a+"/GetTopCategoriesList")},this.loadLocationList=function(b,c){var d={headers:{CommandType:"GetSearchAreaFilter"},params:{city:"Chennai"}};return c.get(a+"/GetSearchAreaFilter",d)},this.loadCurrentLocation=function(a,c){function d(d){b.title=d.coords.latitude,b.value=d.coords.longitude;var e={latlng:d.coords.latitude+","+d.coords.longitude,sensor:!1};c.get("http://maps.googleapis.com/maps/api/geocode/json",{params:e}).then(function(b){b.data.results.length>0?(a.currentAddress=b.data.results[0].formatted_address,a.$parent.currentAddress=a.currentAddress,document.getElementById("areaSearchInput").value=a.currentAddress):a.selectedArea||(document.getElementById("areaSearchInput").value="Chennai")})}function e(){a.selectedArea||(document.getElementById("areaSearchInput").value="Chennai")}b.title||(b.title=a.$parent.defaultLat,b.value=a.$parent.defaultLng),navigator.geolocation?navigator.geolocation.getCurrentPosition(d,e):document.getElementById("areaSearchInput").value="Chennai"}}),app.service("mapService",function(){var a="/VBuy/api/LocationMap";this.getStoreLocationsForCategory=function(b,c,d,e,f,g,h,i){var j={params:{id:d,lat:e,lng:f,mapRadius:g}};return i>0&&(j.params.priceRangeFrom=h,j.params.priceRangeTo=i),c.get(a+"/GetCategoryStoreLocations/",j)},this.getStoreLocationsForProduct=function(b,c,d,e,f,g){var h={headers:{CommandType:"GetProductStoreLocations"},params:{id:d,lat:e,lng:f,mapRadius:g}};return c.get(a+"/GetProductStoreLocations/",h)},this.getStoreLocationsForSearch=function(b,c,d,e,f,g,h,i){var j={params:{productFilter:d,lat:e,lng:f,mapRadius:g}};return i>0&&(j.params.priceRangeFrom=h,j.params.priceRangeTo=i),c.get(a+"/GetSearchStoreLocations/",j)},this.getStoreLocationsForWishlist=function(b,c,d,e,f){var g={params:{lat:d,lng:e,mapRadius:f}};return c.get(a+"/GetWishlistStoreLocations/",g)}}),app.service("orderTrackingService",function(){var a="/VBuy/api/OrderTracking";this.getTrackingOrders=function(b,c){var d={headers:{CommandType:"GetTrackingOrders"}};return c.get(a+"/GetTrackingOrders",d)},this.GetOrdersList=function(b,c){var d={headers:{CommandType:"GetOrdersList"}};return c.get(a+"/GetOrdersList",d)},this.GetProductList=function(b,c,d){var e={headers:{CommandType:"GetProductList"},params:{OrderId:d}};return c.get(a+"/GetProductList",e)},this.CancelOrders=function(b,c,d){var e={headers:{CommandType:"CancelOrders"},params:{OrderId:d}};return c.get(a+"/CancelOrders",e)},this.SearchOrders=function(b,c,d){var e={headers:{CommandType:"SearchOrders"},params:{OrderId:d}};return c.get(a+"/SearchOrders",e)},this.PagingOrders=function(b,c,d){var e={headers:{CommandType:"GetPagingOrders"},params:{PageId:d}};return c.get(a+"/GetPagingOrders",e)}}),app.service("passwordService",function(){var a="/VBuy/api/Login";this.forgotPassword=function(b,c,d){var e={params:{username:d}};return c.get(a+"/ForgotPassword",e)},this.resetPassword=function(b,c,d,e){var f={UserName:d,UniqueId:b.uid,Password:e},g={headers:{CommandType:"ResetPassword"}};return c.post(a+"/ResetPassword",f,g)},this.changePassword=function(b,c,d,e,f){var g={CurrentPassword:e,UserName:d,NewPassword:f},h={headers:{CommandType:"ChangePassword"}};return c.post(a+"/ChangePassword",g,h)}}),app.service("productService",function(){var a="/VBuy/api/Products";this.getRatings=function(b,c,d){var e={params:{productId:d}};return c.get(a+"/GetProductRating/",e)},this.updateRatings=function(b,c,d,e,f){var g={params:{productId:e,rating:f,userName:d}};return c.get(a+"/UpdateProductRating/",g)},this.getProducts=function(b,c,d,e,f,g,h,j,k,l,m,n){var o={id:d,filter:e,lat:f,lng:g,mapRadius:h,pageStart:l,pageSize:m,selectedProductFilter:n},p={headers:{CommandType:"GetProducts_J"}};if(e){for(e.SelectedBrandIdList=[],i=0;i<e.SelectedBrandList.length;i++)e.SelectedBrandIdList.push(e.SelectedBrandList[i].Id);e.SortById=e.SortBy&&e.SortBy.id?e.SortBy.id:0,o.filter=e}return k>0&&(o.priceRangeFrom=j,o.priceRangeTo=k),c.post(a+"/GetProducts_J/",o,p)},this.getWishlistProducts=function(b,c,d,e,f,g,h){var i={params:{lat:d,lng:e,mapRadius:f,pageStart:g,pageSize:h}};return c.get(a+"/GetUserWishlistProducts/",i)},this.getMinMaxForProductCategory=function(b,c,d){var e={params:{id:d}};return c.get(a+"/GetMinMaxForProductCategory/",e)},this.getFiltersForProductCategory=function(b,c,d){var e={params:{id:d}};return c.get(a+"/GetFiltersForProductCategory/",e)},this.getMinMaxForProductSearch=function(b,c,d){var e={params:{search:d}};return c.get(a+"/GetMinMaxForProductSearch/",e)},this.getProductSpecification=function(b,c,d){var e={params:{id:d}};return c.get(a+"/GetProductSpecification/",e)},this.getProductKeyFeatures=function(b,c,d){var e={params:{id:d}};return c.get(a+"/GetProductKeyFeatures/",e)},this.searchCatalogue=function(b,c,d,e,f,g,h,j,k,l,m,n){var o={productFilter:e,filter:f,lat:g,lng:h,mapRadius:j,pageStart:m,pageSize:n},p={headers:{CommandType:"SearchCatalogue_N"}};if(f){for(f.SelectedBrandIdList=[],i=0;i<f.SelectedBrandList.length;i++)f.SelectedBrandIdList.push(f.SelectedBrandList[i].Id);f.SortById=f.SortBy&&f.SortBy.id?f.SortBy.id:0,f.SelectedBrandIdList.length>0&&(o.filter=f)}l>0&&(o.priceRangeFrom=k,o.priceRangeTo=l);var q=d.defer(),r=function(a){q.resolve(a)},s=c.post(a+"/SearchCatalogue_N/",o,p);return{promise:s,cancel:r}},this.getProductDetails=function(b,c,d,e,f,g,h){var i={params:{id:d,flaglocation:e,lat:f,lng:g,mapRadius:h}};return c.get(a+"/GetProductDetails/",i)},this.getAllOffers=function(b,c,d,e){var f={params:{lat:d,lng:e,radius:20}};return c.get(a+"/GetAllOffers",f)},this.getTopOffers=function(b,c,d,e){var f={params:{lat:d,lng:e,radius:20,limit:12}};return c.get(a+"/GetTopOffers",f)},this.contactSeller=function(b,c,d,e,f,g,h,i){var j={Name:d,Email:e,Mobile:f,Subject:g,Branchid:h,ProductId:i},k={headers:{CommandType:"ContactSeller"}};return c.post(a+"/ContactSeller/",j,k)},this.compareProduct=function(b,c,d){var e=new Array(d),f={params:{ids:e.toString()}};return c.get(a+"/GetProductComparison/",f)},this.compareProductDetailedSpecification=function(b,c,d){var e=new Array(d),f={params:{ids:e.toString()}};return c.get(a+"/GetProductDetailedComparison/",f)}}),app.service("storesService",function(){var a="/VBuy/api/Stores";this.getStoreInfo=function(b,c){return b.get(a+"/GetStoreInfo/"+c)},this.getFilter=function(b,c,d){var e={params:{storeId:c,productId:d}};return b.get(a+"/GetStoresProductFilter",e)},this.getStoreProducts=function(b,c){b.filters.storeId=b.StoreInfo.StoreId,b.filters.selectedBranchId=b.selectedBranchId;var d={params:b.filters};return c.get(a+"/GetStoreProducts",d)},this.getRatings=function(b,c,d){var e={params:{branchId:d}};return c.get(a+"/GetBranchRating/",e)},this.updateRatings=function(b,c,d,e,f){var g={params:{branchId:e,rating:f,userName:d}};return c.get(a+"/UpdateBranchRating/",g)}}),app.service("userActionService",function(){var a="/VBuy/api/UserAction",b="/VBuy/api/Login";this.getUserWishlist=function(b,c,d){var e={params:{userName:d}};return c.get(a+"/GetUserWishlist/",e)},this.getUserWishlistCount=function(b,c,d){var e={params:{userName:d}};return c.get(a+"/GetUserWishlistCount/",e)},this.addUserWishlist=function(b,c,d,e){var f={params:{userName:d,productId:e}};return c.get(a+"/AddUserWishList/",f)},this.removeUserWishlist=function(b,c,d,e){var f={params:{userName:d,productId:e}};return c.get(a+"/RemoveUserWishList/",f)},this.RegisterUser=function(a,c,d){var e={headers:{CommandType:"RegisterUser"}};return c.post(b+"/RegisterUser",d,e).then(function(a){return a})},this.getMyDetails=function(a,c,d){var e={params:{username:d}};return c.get(b+"/GetMyDetails",e)}});